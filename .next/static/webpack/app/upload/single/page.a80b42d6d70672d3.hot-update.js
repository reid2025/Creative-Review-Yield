"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
self["webpackHotUpdate_N_E"]("app/upload/single/page",{

/***/ "(app-pages-browser)/./lib/firebase-draft-service.ts":
/*!***************************************!*\
  !*** ./lib/firebase-draft-service.ts ***!
  \***************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval(__webpack_require__.ts("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   FirebaseDraftService: () => (/* binding */ FirebaseDraftService)\n/* harmony export */ });\n/* harmony import */ var firebase_firestore__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! firebase/firestore */ \"(app-pages-browser)/./node_modules/firebase/firestore/dist/esm/index.esm.js\");\n/* harmony import */ var firebase_storage__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! firebase/storage */ \"(app-pages-browser)/./node_modules/firebase/storage/dist/esm/index.esm.js\");\n/* harmony import */ var _firebase__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./firebase */ \"(app-pages-browser)/./lib/firebase.ts\");\n// Firebase Draft Service - Real-time draft management with Firestore\n\n\n\nclass FirebaseDraftService {\n    /**\r\n   * Test Firebase connection\r\n   */ static async testConnection() {\n        try {\n            console.log('ðŸ”¥ Testing Firebase connection...');\n            // Try to read from Firestore\n            const q = (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_0__.query)((0,firebase_firestore__WEBPACK_IMPORTED_MODULE_0__.collection)(_firebase__WEBPACK_IMPORTED_MODULE_2__.db, this.COLLECTION_NAME), (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_0__.where)('isActive', '==', true));\n            await (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_0__.getDocs)(q);\n            console.log('âœ… Firebase connection test successful');\n            return true;\n        } catch (error) {\n            console.error('âŒ Firebase connection test failed:', error);\n            return false;\n        }\n    }\n    /**\r\n   * Save or update a draft in Firestore\r\n   */ static async saveDraft(data, imageFile) {\n        try {\n            console.log('ðŸ”¥ Firebase saveDraft called with data:', data);\n            const draftData = {\n                draftId: data.draftId || this.generateDraftId(),\n                creativeFilename: data.creativeFilename || 'Untitled',\n                lastSaved: (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_0__.serverTimestamp)(),\n                autoSaved: data.autoSaved || false,\n                formData: data.formData || {},\n                aiPopulatedFields: data.aiPopulatedFields || [],\n                version: (data.version || 0) + 1,\n                isActive: true,\n                userId: data.userId || 'anonymous' // In production, use actual user ID\n            };\n            console.log('ðŸ”¥ Prepared draft data for Firebase:', draftData);\n            // Handle image upload if provided\n            if (imageFile) {\n                const imageData = await this.uploadImage(imageFile, draftData.draftId);\n                draftData.imageUrl = imageData.downloadUrl;\n                draftData.imageStoragePath = imageData.storagePath;\n            }\n            // If draftId exists, update existing document\n            if (data.id) {\n                console.log('ðŸ”¥ Updating existing draft with ID:', data.id);\n                const draftRef = (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_0__.doc)(_firebase__WEBPACK_IMPORTED_MODULE_2__.db, this.COLLECTION_NAME, data.id);\n                await (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_0__.updateDoc)(draftRef, {\n                    ...draftData,\n                    lastSaved: (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_0__.serverTimestamp)()\n                });\n                console.log('âœ… Draft updated successfully:', data.id);\n                return data.id;\n            } else {\n                // Create new draft\n                console.log('ðŸ”¥ Creating new draft document');\n                draftData.createdAt = (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_0__.serverTimestamp)();\n                const docRef = await (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_0__.addDoc)((0,firebase_firestore__WEBPACK_IMPORTED_MODULE_0__.collection)(_firebase__WEBPACK_IMPORTED_MODULE_2__.db, this.COLLECTION_NAME), draftData);\n                console.log('âœ… New draft created with ID:', docRef.id);\n                return docRef.id;\n            }\n        } catch (error) {\n            console.error('âŒ Failed to save draft to Firebase:', error);\n            console.error('Firebase error details:', error);\n            throw new Error(\"Failed to save draft: \".concat(error));\n        }\n    }\n    /**\r\n   * Get a single draft by ID\r\n   */ static async getDraft(id) {\n        try {\n            const draftRef = (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_0__.doc)(_firebase__WEBPACK_IMPORTED_MODULE_2__.db, this.COLLECTION_NAME, id);\n            const draftSnap = await (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_0__.getDoc)(draftRef);\n            if (draftSnap.exists()) {\n                return {\n                    id: draftSnap.id,\n                    ...draftSnap.data()\n                };\n            }\n            return null;\n        } catch (error) {\n            console.error('Failed to get draft:', error);\n            return null;\n        }\n    }\n    /**\r\n   * Get all active drafts for a user\r\n   */ static async getAllDrafts() {\n        let userId = arguments.length > 0 && arguments[0] !== void 0 ? arguments[0] : 'anonymous';\n        try {\n            const q = (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_0__.query)((0,firebase_firestore__WEBPACK_IMPORTED_MODULE_0__.collection)(_firebase__WEBPACK_IMPORTED_MODULE_2__.db, this.COLLECTION_NAME), (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_0__.where)('userId', '==', userId), (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_0__.where)('isActive', '==', true), (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_0__.orderBy)('lastSaved', 'desc'));\n            const querySnapshot = await (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_0__.getDocs)(q);\n            const drafts = [];\n            querySnapshot.forEach((doc)=>{\n                drafts.push({\n                    id: doc.id,\n                    ...doc.data()\n                });\n            });\n            return drafts;\n        } catch (error) {\n            console.error('Failed to get drafts:', error);\n            return [];\n        }\n    }\n    /**\r\n   * Delete a draft (soft delete by marking as inactive)\r\n   */ static async deleteDraft(id) {\n        try {\n            const draftRef = (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_0__.doc)(_firebase__WEBPACK_IMPORTED_MODULE_2__.db, this.COLLECTION_NAME, id);\n            // Get draft data to clean up image if needed\n            const draftSnap = await (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_0__.getDoc)(draftRef);\n            if (draftSnap.exists()) {\n                const draftData = draftSnap.data();\n                // Delete image from storage if exists\n                if (draftData.imageStoragePath) {\n                    await this.deleteImage(draftData.imageStoragePath);\n                }\n            }\n            // Soft delete by marking as inactive\n            await (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_0__.updateDoc)(draftRef, {\n                isActive: false,\n                lastSaved: (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_0__.serverTimestamp)()\n            });\n            return true;\n        } catch (error) {\n            console.error('Failed to delete draft:', error);\n            return false;\n        }\n    }\n    /**\r\n   * Set up real-time listener for drafts\r\n   */ static onDraftsChange() {\n        let userId = arguments.length > 0 && arguments[0] !== void 0 ? arguments[0] : 'anonymous', callback = arguments.length > 1 ? arguments[1] : void 0;\n        const q = (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_0__.query)((0,firebase_firestore__WEBPACK_IMPORTED_MODULE_0__.collection)(_firebase__WEBPACK_IMPORTED_MODULE_2__.db, this.COLLECTION_NAME), (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_0__.where)('userId', '==', userId), (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_0__.where)('isActive', '==', true), (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_0__.orderBy)('lastSaved', 'desc'));\n        return (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_0__.onSnapshot)(q, (querySnapshot)=>{\n            const drafts = [];\n            querySnapshot.forEach((doc)=>{\n                drafts.push({\n                    id: doc.id,\n                    ...doc.data()\n                });\n            });\n            callback(drafts);\n        }, (error)=>{\n            console.error('Real-time drafts listener error:', error);\n        });\n    }\n    /**\r\n   * Set up real-time listener for a specific draft\r\n   */ static onDraftChange(draftId, callback) {\n        const draftRef = (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_0__.doc)(_firebase__WEBPACK_IMPORTED_MODULE_2__.db, this.COLLECTION_NAME, draftId);\n        return (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_0__.onSnapshot)(draftRef, (doc)=>{\n            if (doc.exists()) {\n                callback({\n                    id: doc.id,\n                    ...doc.data()\n                });\n            } else {\n                callback(null);\n            }\n        }, (error)=>{\n            console.error('Real-time draft listener error:', error);\n        });\n    }\n    /**\r\n   * Upload image to Firebase Storage\r\n   */ static async uploadImage(file, draftId) {\n        try {\n            const storagePath = \"\".concat(this.STORAGE_PATH, \"/\").concat(draftId, \"/\").concat(file.name);\n            const imageRef = (0,firebase_storage__WEBPACK_IMPORTED_MODULE_1__.ref)(_firebase__WEBPACK_IMPORTED_MODULE_2__.storage, storagePath);\n            await (0,firebase_storage__WEBPACK_IMPORTED_MODULE_1__.uploadBytes)(imageRef, file);\n            const downloadUrl = await (0,firebase_storage__WEBPACK_IMPORTED_MODULE_1__.getDownloadURL)(imageRef);\n            return {\n                downloadUrl,\n                storagePath\n            };\n        } catch (error) {\n            console.error('Failed to upload image:', error);\n            throw new Error('Failed to upload image');\n        }\n    }\n    /**\r\n   * Delete image from Firebase Storage\r\n   */ static async deleteImage(storagePath) {\n        try {\n            const imageRef = (0,firebase_storage__WEBPACK_IMPORTED_MODULE_1__.ref)(_firebase__WEBPACK_IMPORTED_MODULE_2__.storage, storagePath);\n            await (0,firebase_storage__WEBPACK_IMPORTED_MODULE_1__.deleteObject)(imageRef);\n        } catch (error) {\n            console.error('Failed to delete image:', error);\n        // Don't throw error as this is cleanup\n        }\n    }\n    /**\r\n   * Generate unique draft ID\r\n   */ static generateDraftId() {\n        return \"draft_\".concat(Date.now(), \"_\").concat(Math.random().toString(36).substr(2, 9));\n    }\n    /**\r\n   * Migrate existing localStorage drafts to Firebase\r\n   */ static async migrateLocalDrafts() {\n        try {\n            // Import the existing draft storage to access local drafts\n            const { DraftStorageV2 } = await __webpack_require__.e(/*! import() */ \"_app-pages-browser_utils_draftStorage_v2_ts\").then(__webpack_require__.bind(__webpack_require__, /*! ../utils/draftStorage.v2 */ \"(app-pages-browser)/./utils/draftStorage.v2.ts\"));\n            const localDrafts = DraftStorageV2.getAllDrafts();\n            console.log(\"Found \".concat(localDrafts.length, \" local drafts to migrate\"));\n            for (const localDraft of localDrafts){\n                try {\n                    const firebaseDraft = {\n                        draftId: localDraft.draftId,\n                        creativeFilename: localDraft.creativeFilename,\n                        formData: localDraft.formData,\n                        autoSaved: localDraft.autoSaved,\n                        version: 1,\n                        isActive: true\n                    };\n                    await this.saveDraft(firebaseDraft);\n                    console.log(\"Migrated draft: \".concat(localDraft.creativeFilename));\n                } catch (error) {\n                    console.error(\"Failed to migrate draft \".concat(localDraft.draftId, \":\"), error);\n                }\n            }\n            console.log('Draft migration completed');\n        } catch (error) {\n            console.error('Failed to migrate local drafts:', error);\n        }\n    }\n    /**\r\n   * Get real-time tracking statistics\r\n   */ static async getTrackingStats() {\n        let userId = arguments.length > 0 && arguments[0] !== void 0 ? arguments[0] : 'anonymous';\n        try {\n            const drafts = await this.getAllDrafts(userId);\n            const stats = {\n                totalDrafts: drafts.length,\n                autoSavedCount: drafts.filter((d)=>d.autoSaved).length,\n                manualSavedCount: drafts.filter((d)=>!d.autoSaved).length,\n                aiPopulatedCount: drafts.filter((d)=>d.aiPopulatedFields && d.aiPopulatedFields.length > 0).length\n            };\n            return stats;\n        } catch (error) {\n            console.error('Failed to get tracking stats:', error);\n            return {\n                totalDrafts: 0,\n                autoSavedCount: 0,\n                manualSavedCount: 0,\n                aiPopulatedCount: 0\n            };\n        }\n    }\n}\nFirebaseDraftService.COLLECTION_NAME = 'drafts';\nFirebaseDraftService.STORAGE_PATH = 'draft-images';\n\n\n;\n    // Wrapped in an IIFE to avoid polluting the global scope\n    ;\n    (function () {\n        var _a, _b;\n        // Legacy CSS implementations will `eval` browser code in a Node.js context\n        // to extract CSS. For backwards compatibility, we need to check we're in a\n        // browser context before continuing.\n        if (typeof self !== 'undefined' &&\n            // AMP / No-JS mode does not inject these helpers:\n            '$RefreshHelpers$' in self) {\n            // @ts-ignore __webpack_module__ is global\n            var currentExports = module.exports;\n            // @ts-ignore __webpack_module__ is global\n            var prevSignature = (_b = (_a = module.hot.data) === null || _a === void 0 ? void 0 : _a.prevSignature) !== null && _b !== void 0 ? _b : null;\n            // This cannot happen in MainTemplate because the exports mismatch between\n            // templating and execution.\n            self.$RefreshHelpers$.registerExportsForReactRefresh(currentExports, module.id);\n            // A module can be accepted automatically based on its exports, e.g. when\n            // it is a Refresh Boundary.\n            if (self.$RefreshHelpers$.isReactRefreshBoundary(currentExports)) {\n                // Save the previous exports signature on update so we can compare the boundary\n                // signatures. We avoid saving exports themselves since it causes memory leaks (https://github.com/vercel/next.js/pull/53797)\n                module.hot.dispose(function (data) {\n                    data.prevSignature =\n                        self.$RefreshHelpers$.getRefreshBoundarySignature(currentExports);\n                });\n                // Unconditionally accept an update to this module, we'll check if it's\n                // still a Refresh Boundary later.\n                // @ts-ignore importMeta is replaced in the loader\n                module.hot.accept();\n                // This field is set when the previous version of this module was a\n                // Refresh Boundary, letting us know we need to check for invalidation or\n                // enqueue an update.\n                if (prevSignature !== null) {\n                    // A boundary can become ineligible if its exports are incompatible\n                    // with the previous exports.\n                    //\n                    // For example, if you add/remove/change exports, we'll want to\n                    // re-execute the importing modules, and force those components to\n                    // re-render. Similarly, if you convert a class component to a\n                    // function, we want to invalidate the boundary.\n                    if (self.$RefreshHelpers$.shouldInvalidateReactRefreshBoundary(prevSignature, self.$RefreshHelpers$.getRefreshBoundarySignature(currentExports))) {\n                        module.hot.invalidate();\n                    }\n                    else {\n                        self.$RefreshHelpers$.scheduleUpdate();\n                    }\n                }\n            }\n            else {\n                // Since we just executed the code for the module, it's possible that the\n                // new exports made it ineligible for being a boundary.\n                // We only care about the case when we were _previously_ a boundary,\n                // because we already accepted this update (accidental side effect).\n                var isNoLongerABoundary = prevSignature !== null;\n                if (isNoLongerABoundary) {\n                    module.hot.invalidate();\n                }\n            }\n        }\n    })();\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwcC1wYWdlcy1icm93c2VyKS8uL2xpYi9maXJlYmFzZS1kcmFmdC1zZXJ2aWNlLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBQSxxRUFBcUU7QUFlMUM7QUFDc0Q7QUFDekM7QUFtQmpDLE1BQU1pQjtJQUlYOztHQUVDLEdBQ0QsYUFBYUMsaUJBQW1DO1FBQzlDLElBQUk7WUFDRkMsUUFBUUMsR0FBRyxDQUFDO1lBQ1osNkJBQTZCO1lBQzdCLE1BQU1DLElBQUlkLHlEQUFLQSxDQUFDUCw4REFBVUEsQ0FBQ2UseUNBQUVBLEVBQUUsSUFBSSxDQUFDTyxlQUFlLEdBQUdkLHlEQUFLQSxDQUFDLFlBQVksTUFBTTtZQUM5RSxNQUFNSiwyREFBT0EsQ0FBQ2lCO1lBQ2RGLFFBQVFDLEdBQUcsQ0FBQztZQUNaLE9BQU87UUFDVCxFQUFFLE9BQU9HLE9BQU87WUFDZEosUUFBUUksS0FBSyxDQUFDLHNDQUFzQ0E7WUFDcEQsT0FBTztRQUNUO0lBQ0Y7SUFFQTs7R0FFQyxHQUNELGFBQWFDLFVBQVVDLElBQWdDLEVBQUVDLFNBQWdCLEVBQW1CO1FBQzFGLElBQUk7WUFDRlAsUUFBUUMsR0FBRyxDQUFDLDJDQUEyQ0s7WUFFdkQsTUFBTUUsWUFBd0M7Z0JBQzVDQyxTQUFTSCxLQUFLRyxPQUFPLElBQUksSUFBSSxDQUFDQyxlQUFlO2dCQUM3Q0Msa0JBQWtCTCxLQUFLSyxnQkFBZ0IsSUFBSTtnQkFDM0NDLFdBQVdyQixtRUFBZUE7Z0JBQzFCc0IsV0FBV1AsS0FBS08sU0FBUyxJQUFJO2dCQUM3QkMsVUFBVVIsS0FBS1EsUUFBUSxJQUFJLENBQUM7Z0JBQzVCQyxtQkFBbUJULEtBQUtTLGlCQUFpQixJQUFJLEVBQUU7Z0JBQy9DQyxTQUFTLENBQUNWLEtBQUtVLE9BQU8sSUFBSSxLQUFLO2dCQUMvQkMsVUFBVTtnQkFDVkMsUUFBUVosS0FBS1ksTUFBTSxJQUFJLFlBQVksb0NBQW9DO1lBQ3pFO1lBRUFsQixRQUFRQyxHQUFHLENBQUMsd0NBQXdDTztZQUVwRCxrQ0FB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QU0wQyxRQUFRO2dCQUNaQyxhQUFhMUIsT0FBT3FCLE1BQU07Z0JBQzFCTSxnQkFBZ0IzQixPQUFPNEIsTUFBTSxDQUFDQyxDQUFBQSxJQUFLQSxFQUFFbkQsU0FBUyxFQUFFMkMsTUFBTTtnQkFDdERTLGtCQUFrQjlCLE9BQU80QixNQUFNLENBQUNDLENBQUFBLElBQUssQ0FBQ0EsRUFBRW5ELFNBQVMsRUFBRTJDLE1BQU07Z0JBQ3pEVSxrQkFBa0IvQixPQUFPNEIsTUFBTSxDQUFDQyxDQUFBQSxJQUFLQSxFQUFFakQsaUJBQWlCLElBQUlpRCxFQUFFakQsaUJBQWlCLENBQUN5QyxNQUFNLEdBQUcsR0FBR0EsTUFBTTtZQUNwRztZQUVBLE9BQU9JO1FBQ1QsRUFBRSxPQUFPeEQsT0FBTztZQUNkSixRQUFRSSxLQUFLLENBQUMsaUNBQWlDQTtZQUMvQyxPQUFPO2dCQUNMeUQsYUFBYTtnQkFDYkMsZ0JBQWdCO2dCQUNoQkcsa0JBQWtCO2dCQUNsQkMsa0JBQWtCO1lBQ3BCO1FBQ0Y7SUFDRjtBQUNGO0FBL1NhcEUscUJBQ2FLLGtCQUFrQjtBQUQvQkwscUJBRWE4QyxlQUFlIiwic291cmNlcyI6WyJEOlxcSXN0aWFuIEZpbGVzXFxUaXNlZ1xcQ1JZIEFwcFxcbGliXFxmaXJlYmFzZS1kcmFmdC1zZXJ2aWNlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIEZpcmViYXNlIERyYWZ0IFNlcnZpY2UgLSBSZWFsLXRpbWUgZHJhZnQgbWFuYWdlbWVudCB3aXRoIEZpcmVzdG9yZVxyXG5pbXBvcnQgeyBcclxuICBjb2xsZWN0aW9uLCBcclxuICBkb2MsIFxyXG4gIGFkZERvYywgXHJcbiAgdXBkYXRlRG9jLCBcclxuICBkZWxldGVEb2MsIFxyXG4gIGdldERvY3MsIFxyXG4gIGdldERvYyxcclxuICBvblNuYXBzaG90LFxyXG4gIHF1ZXJ5LFxyXG4gIHdoZXJlLFxyXG4gIG9yZGVyQnksXHJcbiAgVGltZXN0YW1wLFxyXG4gIHNlcnZlclRpbWVzdGFtcFxyXG59IGZyb20gJ2ZpcmViYXNlL2ZpcmVzdG9yZSdcclxuaW1wb3J0IHsgcmVmLCB1cGxvYWRCeXRlcywgZ2V0RG93bmxvYWRVUkwsIGRlbGV0ZU9iamVjdCB9IGZyb20gJ2ZpcmViYXNlL3N0b3JhZ2UnXHJcbmltcG9ydCB7IGRiLCBzdG9yYWdlIH0gZnJvbSAnLi9maXJlYmFzZSdcclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgRmlyZWJhc2VEcmFmdERhdGEge1xyXG4gIGlkPzogc3RyaW5nXHJcbiAgZHJhZnRJZDogc3RyaW5nXHJcbiAgY3JlYXRpdmVGaWxlbmFtZTogc3RyaW5nXHJcbiAgbGFzdFNhdmVkOiBUaW1lc3RhbXBcclxuICBjcmVhdGVkQXQ6IFRpbWVzdGFtcFxyXG4gIGF1dG9TYXZlZD86IGJvb2xlYW5cclxuICBmb3JtRGF0YTogYW55XHJcbiAgaW1hZ2VVcmw/OiBzdHJpbmdcclxuICBpbWFnZVN0b3JhZ2VQYXRoPzogc3RyaW5nXHJcbiAgdXNlcklkPzogc3RyaW5nXHJcbiAgLy8gQWRkaXRpb25hbCB0cmFja2luZyBmaWVsZHMgYXMgcGVyIHJlcXVpcmVtZW50c1xyXG4gIGFpUG9wdWxhdGVkRmllbGRzPzogc3RyaW5nW11cclxuICB2ZXJzaW9uOiBudW1iZXJcclxuICBpc0FjdGl2ZTogYm9vbGVhblxyXG59XHJcblxyXG5leHBvcnQgY2xhc3MgRmlyZWJhc2VEcmFmdFNlcnZpY2Uge1xyXG4gIHByaXZhdGUgc3RhdGljIHJlYWRvbmx5IENPTExFQ1RJT05fTkFNRSA9ICdkcmFmdHMnXHJcbiAgcHJpdmF0ZSBzdGF0aWMgcmVhZG9ubHkgU1RPUkFHRV9QQVRIID0gJ2RyYWZ0LWltYWdlcydcclxuXHJcbiAgLyoqXHJcbiAgICogVGVzdCBGaXJlYmFzZSBjb25uZWN0aW9uXHJcbiAgICovXHJcbiAgc3RhdGljIGFzeW5jIHRlc3RDb25uZWN0aW9uKCk6IFByb21pc2U8Ym9vbGVhbj4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc29sZS5sb2coJ/CflKUgVGVzdGluZyBGaXJlYmFzZSBjb25uZWN0aW9uLi4uJylcclxuICAgICAgLy8gVHJ5IHRvIHJlYWQgZnJvbSBGaXJlc3RvcmVcclxuICAgICAgY29uc3QgcSA9IHF1ZXJ5KGNvbGxlY3Rpb24oZGIsIHRoaXMuQ09MTEVDVElPTl9OQU1FKSwgd2hlcmUoJ2lzQWN0aXZlJywgJz09JywgdHJ1ZSkpXHJcbiAgICAgIGF3YWl0IGdldERvY3MocSlcclxuICAgICAgY29uc29sZS5sb2coJ+KchSBGaXJlYmFzZSBjb25uZWN0aW9uIHRlc3Qgc3VjY2Vzc2Z1bCcpXHJcbiAgICAgIHJldHVybiB0cnVlXHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCfinYwgRmlyZWJhc2UgY29ubmVjdGlvbiB0ZXN0IGZhaWxlZDonLCBlcnJvcilcclxuICAgICAgcmV0dXJuIGZhbHNlXHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBTYXZlIG9yIHVwZGF0ZSBhIGRyYWZ0IGluIEZpcmVzdG9yZVxyXG4gICAqL1xyXG4gIHN0YXRpYyBhc3luYyBzYXZlRHJhZnQoZGF0YTogUGFydGlhbDxGaXJlYmFzZURyYWZ0RGF0YT4sIGltYWdlRmlsZT86IEZpbGUpOiBQcm9taXNlPHN0cmluZz4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc29sZS5sb2coJ/CflKUgRmlyZWJhc2Ugc2F2ZURyYWZ0IGNhbGxlZCB3aXRoIGRhdGE6JywgZGF0YSlcclxuICAgICAgXHJcbiAgICAgIGNvbnN0IGRyYWZ0RGF0YTogUGFydGlhbDxGaXJlYmFzZURyYWZ0RGF0YT4gPSB7XHJcbiAgICAgICAgZHJhZnRJZDogZGF0YS5kcmFmdElkIHx8IHRoaXMuZ2VuZXJhdGVEcmFmdElkKCksXHJcbiAgICAgICAgY3JlYXRpdmVGaWxlbmFtZTogZGF0YS5jcmVhdGl2ZUZpbGVuYW1lIHx8ICdVbnRpdGxlZCcsXHJcbiAgICAgICAgbGFzdFNhdmVkOiBzZXJ2ZXJUaW1lc3RhbXAoKSBhcyBUaW1lc3RhbXAsXHJcbiAgICAgICAgYXV0b1NhdmVkOiBkYXRhLmF1dG9TYXZlZCB8fCBmYWxzZSxcclxuICAgICAgICBmb3JtRGF0YTogZGF0YS5mb3JtRGF0YSB8fCB7fSxcclxuICAgICAgICBhaVBvcHVsYXRlZEZpZWxkczogZGF0YS5haVBvcHVsYXRlZEZpZWxkcyB8fCBbXSxcclxuICAgICAgICB2ZXJzaW9uOiAoZGF0YS52ZXJzaW9uIHx8IDApICsgMSxcclxuICAgICAgICBpc0FjdGl2ZTogdHJ1ZSxcclxuICAgICAgICB1c2VySWQ6IGRhdGEudXNlcklkIHx8ICdhbm9ueW1vdXMnIC8vIEluIHByb2R1Y3Rpb24sIHVzZSBhY3R1YWwgdXNlciBJRFxyXG4gICAgICB9XHJcblxyXG4gICAgICBjb25zb2xlLmxvZygn8J+UpSBQcmVwYXJlZCBkcmFmdCBkYXRhIGZvciBGaXJlYmFzZTonLCBkcmFmdERhdGEpXHJcblxyXG4gICAgICAvLyBIYW5kbGUgaW1hZ2UgdXBsb2FkIGlmIHByb3ZpZGVkXHJcbiAgICAgIGlmIChpbWFnZUZpbGUpIHtcclxuICAgICAgICBjb25zdCBpbWFnZURhdGEgPSBhd2FpdCB0aGlzLnVwbG9hZEltYWdlKGltYWdlRmlsZSwgZHJhZnREYXRhLmRyYWZ0SWQhKVxyXG4gICAgICAgIGRyYWZ0RGF0YS5pbWFnZVVybCA9IGltYWdlRGF0YS5kb3dubG9hZFVybFxyXG4gICAgICAgIGRyYWZ0RGF0YS5pbWFnZVN0b3JhZ2VQYXRoID0gaW1hZ2VEYXRhLnN0b3JhZ2VQYXRoXHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIElmIGRyYWZ0SWQgZXhpc3RzLCB1cGRhdGUgZXhpc3RpbmcgZG9jdW1lbnRcclxuICAgICAgaWYgKGRhdGEuaWQpIHtcclxuICAgICAgICBjb25zb2xlLmxvZygn8J+UpSBVcGRhdGluZyBleGlzdGluZyBkcmFmdCB3aXRoIElEOicsIGRhdGEuaWQpXHJcbiAgICAgICAgY29uc3QgZHJhZnRSZWYgPSBkb2MoZGIsIHRoaXMuQ09MTEVDVElPTl9OQU1FLCBkYXRhLmlkKVxyXG4gICAgICAgIGF3YWl0IHVwZGF0ZURvYyhkcmFmdFJlZiwge1xyXG4gICAgICAgICAgLi4uZHJhZnREYXRhLFxyXG4gICAgICAgICAgbGFzdFNhdmVkOiBzZXJ2ZXJUaW1lc3RhbXAoKVxyXG4gICAgICAgIH0pXHJcbiAgICAgICAgY29uc29sZS5sb2coJ+KchSBEcmFmdCB1cGRhdGVkIHN1Y2Nlc3NmdWxseTonLCBkYXRhLmlkKVxyXG4gICAgICAgIHJldHVybiBkYXRhLmlkXHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgLy8gQ3JlYXRlIG5ldyBkcmFmdFxyXG4gICAgICAgIGNvbnNvbGUubG9nKCfwn5SlIENyZWF0aW5nIG5ldyBkcmFmdCBkb2N1bWVudCcpXHJcbiAgICAgICAgZHJhZnREYXRhLmNyZWF0ZWRBdCA9IHNlcnZlclRpbWVzdGFtcCgpIGFzIFRpbWVzdGFtcFxyXG4gICAgICAgIGNvbnN0IGRvY1JlZiA9IGF3YWl0IGFkZERvYyhjb2xsZWN0aW9uKGRiLCB0aGlzLkNPTExFQ1RJT05fTkFNRSksIGRyYWZ0RGF0YSlcclxuICAgICAgICBjb25zb2xlLmxvZygn4pyFIE5ldyBkcmFmdCBjcmVhdGVkIHdpdGggSUQ6JywgZG9jUmVmLmlkKVxyXG4gICAgICAgIHJldHVybiBkb2NSZWYuaWRcclxuICAgICAgfVxyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcign4p2MIEZhaWxlZCB0byBzYXZlIGRyYWZ0IHRvIEZpcmViYXNlOicsIGVycm9yKVxyXG4gICAgICBjb25zb2xlLmVycm9yKCdGaXJlYmFzZSBlcnJvciBkZXRhaWxzOicsIGVycm9yKVxyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYEZhaWxlZCB0byBzYXZlIGRyYWZ0OiAke2Vycm9yfWApXHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBHZXQgYSBzaW5nbGUgZHJhZnQgYnkgSURcclxuICAgKi9cclxuICBzdGF0aWMgYXN5bmMgZ2V0RHJhZnQoaWQ6IHN0cmluZyk6IFByb21pc2U8RmlyZWJhc2VEcmFmdERhdGEgfCBudWxsPiB7XHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCBkcmFmdFJlZiA9IGRvYyhkYiwgdGhpcy5DT0xMRUNUSU9OX05BTUUsIGlkKVxyXG4gICAgICBjb25zdCBkcmFmdFNuYXAgPSBhd2FpdCBnZXREb2MoZHJhZnRSZWYpXHJcbiAgICAgIFxyXG4gICAgICBpZiAoZHJhZnRTbmFwLmV4aXN0cygpKSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgIGlkOiBkcmFmdFNuYXAuaWQsXHJcbiAgICAgICAgICAuLi5kcmFmdFNuYXAuZGF0YSgpXHJcbiAgICAgICAgfSBhcyBGaXJlYmFzZURyYWZ0RGF0YVxyXG4gICAgICB9XHJcbiAgICAgIHJldHVybiBudWxsXHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdGYWlsZWQgdG8gZ2V0IGRyYWZ0OicsIGVycm9yKVxyXG4gICAgICByZXR1cm4gbnVsbFxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogR2V0IGFsbCBhY3RpdmUgZHJhZnRzIGZvciBhIHVzZXJcclxuICAgKi9cclxuICBzdGF0aWMgYXN5bmMgZ2V0QWxsRHJhZnRzKHVzZXJJZDogc3RyaW5nID0gJ2Fub255bW91cycpOiBQcm9taXNlPEZpcmViYXNlRHJhZnREYXRhW10+IHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IHEgPSBxdWVyeShcclxuICAgICAgICBjb2xsZWN0aW9uKGRiLCB0aGlzLkNPTExFQ1RJT05fTkFNRSksXHJcbiAgICAgICAgd2hlcmUoJ3VzZXJJZCcsICc9PScsIHVzZXJJZCksXHJcbiAgICAgICAgd2hlcmUoJ2lzQWN0aXZlJywgJz09JywgdHJ1ZSksXHJcbiAgICAgICAgb3JkZXJCeSgnbGFzdFNhdmVkJywgJ2Rlc2MnKVxyXG4gICAgICApXHJcbiAgICAgIFxyXG4gICAgICBjb25zdCBxdWVyeVNuYXBzaG90ID0gYXdhaXQgZ2V0RG9jcyhxKVxyXG4gICAgICBjb25zdCBkcmFmdHM6IEZpcmViYXNlRHJhZnREYXRhW10gPSBbXVxyXG4gICAgICBcclxuICAgICAgcXVlcnlTbmFwc2hvdC5mb3JFYWNoKChkb2MpID0+IHtcclxuICAgICAgICBkcmFmdHMucHVzaCh7XHJcbiAgICAgICAgICBpZDogZG9jLmlkLFxyXG4gICAgICAgICAgLi4uZG9jLmRhdGEoKVxyXG4gICAgICAgIH0gYXMgRmlyZWJhc2VEcmFmdERhdGEpXHJcbiAgICAgIH0pXHJcbiAgICAgIFxyXG4gICAgICByZXR1cm4gZHJhZnRzXHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdGYWlsZWQgdG8gZ2V0IGRyYWZ0czonLCBlcnJvcilcclxuICAgICAgcmV0dXJuIFtdXHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBEZWxldGUgYSBkcmFmdCAoc29mdCBkZWxldGUgYnkgbWFya2luZyBhcyBpbmFjdGl2ZSlcclxuICAgKi9cclxuICBzdGF0aWMgYXN5bmMgZGVsZXRlRHJhZnQoaWQ6IHN0cmluZyk6IFByb21pc2U8Ym9vbGVhbj4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgZHJhZnRSZWYgPSBkb2MoZGIsIHRoaXMuQ09MTEVDVElPTl9OQU1FLCBpZClcclxuICAgICAgXHJcbiAgICAgIC8vIEdldCBkcmFmdCBkYXRhIHRvIGNsZWFuIHVwIGltYWdlIGlmIG5lZWRlZFxyXG4gICAgICBjb25zdCBkcmFmdFNuYXAgPSBhd2FpdCBnZXREb2MoZHJhZnRSZWYpXHJcbiAgICAgIGlmIChkcmFmdFNuYXAuZXhpc3RzKCkpIHtcclxuICAgICAgICBjb25zdCBkcmFmdERhdGEgPSBkcmFmdFNuYXAuZGF0YSgpIGFzIEZpcmViYXNlRHJhZnREYXRhXHJcbiAgICAgICAgXHJcbiAgICAgICAgLy8gRGVsZXRlIGltYWdlIGZyb20gc3RvcmFnZSBpZiBleGlzdHNcclxuICAgICAgICBpZiAoZHJhZnREYXRhLmltYWdlU3RvcmFnZVBhdGgpIHtcclxuICAgICAgICAgIGF3YWl0IHRoaXMuZGVsZXRlSW1hZ2UoZHJhZnREYXRhLmltYWdlU3RvcmFnZVBhdGgpXHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgICAvLyBTb2Z0IGRlbGV0ZSBieSBtYXJraW5nIGFzIGluYWN0aXZlXHJcbiAgICAgIGF3YWl0IHVwZGF0ZURvYyhkcmFmdFJlZiwge1xyXG4gICAgICAgIGlzQWN0aXZlOiBmYWxzZSxcclxuICAgICAgICBsYXN0U2F2ZWQ6IHNlcnZlclRpbWVzdGFtcCgpXHJcbiAgICAgIH0pXHJcbiAgICAgIFxyXG4gICAgICByZXR1cm4gdHJ1ZVxyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRmFpbGVkIHRvIGRlbGV0ZSBkcmFmdDonLCBlcnJvcilcclxuICAgICAgcmV0dXJuIGZhbHNlXHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBTZXQgdXAgcmVhbC10aW1lIGxpc3RlbmVyIGZvciBkcmFmdHNcclxuICAgKi9cclxuICBzdGF0aWMgb25EcmFmdHNDaGFuZ2UodXNlcklkOiBzdHJpbmcgPSAnYW5vbnltb3VzJywgY2FsbGJhY2s6IChkcmFmdHM6IEZpcmViYXNlRHJhZnREYXRhW10pID0+IHZvaWQpOiAoKSA9PiB2b2lkIHtcclxuICAgIGNvbnN0IHEgPSBxdWVyeShcclxuICAgICAgY29sbGVjdGlvbihkYiwgdGhpcy5DT0xMRUNUSU9OX05BTUUpLFxyXG4gICAgICB3aGVyZSgndXNlcklkJywgJz09JywgdXNlcklkKSxcclxuICAgICAgd2hlcmUoJ2lzQWN0aXZlJywgJz09JywgdHJ1ZSksXHJcbiAgICAgIG9yZGVyQnkoJ2xhc3RTYXZlZCcsICdkZXNjJylcclxuICAgIClcclxuXHJcbiAgICByZXR1cm4gb25TbmFwc2hvdChxLCAocXVlcnlTbmFwc2hvdCkgPT4ge1xyXG4gICAgICBjb25zdCBkcmFmdHM6IEZpcmViYXNlRHJhZnREYXRhW10gPSBbXVxyXG4gICAgICBxdWVyeVNuYXBzaG90LmZvckVhY2goKGRvYykgPT4ge1xyXG4gICAgICAgIGRyYWZ0cy5wdXNoKHtcclxuICAgICAgICAgIGlkOiBkb2MuaWQsXHJcbiAgICAgICAgICAuLi5kb2MuZGF0YSgpXHJcbiAgICAgICAgfSBhcyBGaXJlYmFzZURyYWZ0RGF0YSlcclxuICAgICAgfSlcclxuICAgICAgY2FsbGJhY2soZHJhZnRzKVxyXG4gICAgfSwgKGVycm9yKSA9PiB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ1JlYWwtdGltZSBkcmFmdHMgbGlzdGVuZXIgZXJyb3I6JywgZXJyb3IpXHJcbiAgICB9KVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU2V0IHVwIHJlYWwtdGltZSBsaXN0ZW5lciBmb3IgYSBzcGVjaWZpYyBkcmFmdFxyXG4gICAqL1xyXG4gIHN0YXRpYyBvbkRyYWZ0Q2hhbmdlKGRyYWZ0SWQ6IHN0cmluZywgY2FsbGJhY2s6IChkcmFmdDogRmlyZWJhc2VEcmFmdERhdGEgfCBudWxsKSA9PiB2b2lkKTogKCkgPT4gdm9pZCB7XHJcbiAgICBjb25zdCBkcmFmdFJlZiA9IGRvYyhkYiwgdGhpcy5DT0xMRUNUSU9OX05BTUUsIGRyYWZ0SWQpXHJcbiAgICBcclxuICAgIHJldHVybiBvblNuYXBzaG90KGRyYWZ0UmVmLCAoZG9jKSA9PiB7XHJcbiAgICAgIGlmIChkb2MuZXhpc3RzKCkpIHtcclxuICAgICAgICBjYWxsYmFjayh7XHJcbiAgICAgICAgICBpZDogZG9jLmlkLFxyXG4gICAgICAgICAgLi4uZG9jLmRhdGEoKVxyXG4gICAgICAgIH0gYXMgRmlyZWJhc2VEcmFmdERhdGEpXHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgY2FsbGJhY2sobnVsbClcclxuICAgICAgfVxyXG4gICAgfSwgKGVycm9yKSA9PiB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ1JlYWwtdGltZSBkcmFmdCBsaXN0ZW5lciBlcnJvcjonLCBlcnJvcilcclxuICAgIH0pXHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBVcGxvYWQgaW1hZ2UgdG8gRmlyZWJhc2UgU3RvcmFnZVxyXG4gICAqL1xyXG4gIHByaXZhdGUgc3RhdGljIGFzeW5jIHVwbG9hZEltYWdlKGZpbGU6IEZpbGUsIGRyYWZ0SWQ6IHN0cmluZyk6IFByb21pc2U8eyBkb3dubG9hZFVybDogc3RyaW5nLCBzdG9yYWdlUGF0aDogc3RyaW5nIH0+IHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IHN0b3JhZ2VQYXRoID0gYCR7dGhpcy5TVE9SQUdFX1BBVEh9LyR7ZHJhZnRJZH0vJHtmaWxlLm5hbWV9YFxyXG4gICAgICBjb25zdCBpbWFnZVJlZiA9IHJlZihzdG9yYWdlLCBzdG9yYWdlUGF0aClcclxuICAgICAgXHJcbiAgICAgIGF3YWl0IHVwbG9hZEJ5dGVzKGltYWdlUmVmLCBmaWxlKVxyXG4gICAgICBjb25zdCBkb3dubG9hZFVybCA9IGF3YWl0IGdldERvd25sb2FkVVJMKGltYWdlUmVmKVxyXG4gICAgICBcclxuICAgICAgcmV0dXJuIHsgZG93bmxvYWRVcmwsIHN0b3JhZ2VQYXRoIH1cclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0ZhaWxlZCB0byB1cGxvYWQgaW1hZ2U6JywgZXJyb3IpXHJcbiAgICAgIHRocm93IG5ldyBFcnJvcignRmFpbGVkIHRvIHVwbG9hZCBpbWFnZScpXHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBEZWxldGUgaW1hZ2UgZnJvbSBGaXJlYmFzZSBTdG9yYWdlXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBzdGF0aWMgYXN5bmMgZGVsZXRlSW1hZ2Uoc3RvcmFnZVBhdGg6IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgaW1hZ2VSZWYgPSByZWYoc3RvcmFnZSwgc3RvcmFnZVBhdGgpXHJcbiAgICAgIGF3YWl0IGRlbGV0ZU9iamVjdChpbWFnZVJlZilcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0ZhaWxlZCB0byBkZWxldGUgaW1hZ2U6JywgZXJyb3IpXHJcbiAgICAgIC8vIERvbid0IHRocm93IGVycm9yIGFzIHRoaXMgaXMgY2xlYW51cFxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogR2VuZXJhdGUgdW5pcXVlIGRyYWZ0IElEXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBzdGF0aWMgZ2VuZXJhdGVEcmFmdElkKCk6IHN0cmluZyB7XHJcbiAgICByZXR1cm4gYGRyYWZ0XyR7RGF0ZS5ub3coKX1fJHtNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zdWJzdHIoMiwgOSl9YFxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogTWlncmF0ZSBleGlzdGluZyBsb2NhbFN0b3JhZ2UgZHJhZnRzIHRvIEZpcmViYXNlXHJcbiAgICovXHJcbiAgc3RhdGljIGFzeW5jIG1pZ3JhdGVMb2NhbERyYWZ0cygpOiBQcm9taXNlPHZvaWQ+IHtcclxuICAgIHRyeSB7XHJcbiAgICAgIC8vIEltcG9ydCB0aGUgZXhpc3RpbmcgZHJhZnQgc3RvcmFnZSB0byBhY2Nlc3MgbG9jYWwgZHJhZnRzXHJcbiAgICAgIGNvbnN0IHsgRHJhZnRTdG9yYWdlVjIgfSA9IGF3YWl0IGltcG9ydCgnLi4vdXRpbHMvZHJhZnRTdG9yYWdlLnYyJylcclxuICAgICAgY29uc3QgbG9jYWxEcmFmdHMgPSBEcmFmdFN0b3JhZ2VWMi5nZXRBbGxEcmFmdHMoKVxyXG4gICAgICBcclxuICAgICAgY29uc29sZS5sb2coYEZvdW5kICR7bG9jYWxEcmFmdHMubGVuZ3RofSBsb2NhbCBkcmFmdHMgdG8gbWlncmF0ZWApXHJcbiAgICAgIFxyXG4gICAgICBmb3IgKGNvbnN0IGxvY2FsRHJhZnQgb2YgbG9jYWxEcmFmdHMpIHtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgY29uc3QgZmlyZWJhc2VEcmFmdDogUGFydGlhbDxGaXJlYmFzZURyYWZ0RGF0YT4gPSB7XHJcbiAgICAgICAgICAgIGRyYWZ0SWQ6IGxvY2FsRHJhZnQuZHJhZnRJZCxcclxuICAgICAgICAgICAgY3JlYXRpdmVGaWxlbmFtZTogbG9jYWxEcmFmdC5jcmVhdGl2ZUZpbGVuYW1lLFxyXG4gICAgICAgICAgICBmb3JtRGF0YTogbG9jYWxEcmFmdC5mb3JtRGF0YSxcclxuICAgICAgICAgICAgYXV0b1NhdmVkOiBsb2NhbERyYWZ0LmF1dG9TYXZlZCxcclxuICAgICAgICAgICAgdmVyc2lvbjogMSxcclxuICAgICAgICAgICAgaXNBY3RpdmU6IHRydWVcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIFxyXG4gICAgICAgICAgYXdhaXQgdGhpcy5zYXZlRHJhZnQoZmlyZWJhc2VEcmFmdClcclxuICAgICAgICAgIGNvbnNvbGUubG9nKGBNaWdyYXRlZCBkcmFmdDogJHtsb2NhbERyYWZ0LmNyZWF0aXZlRmlsZW5hbWV9YClcclxuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgICAgY29uc29sZS5lcnJvcihgRmFpbGVkIHRvIG1pZ3JhdGUgZHJhZnQgJHtsb2NhbERyYWZ0LmRyYWZ0SWR9OmAsIGVycm9yKVxyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgICBcclxuICAgICAgY29uc29sZS5sb2coJ0RyYWZ0IG1pZ3JhdGlvbiBjb21wbGV0ZWQnKVxyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRmFpbGVkIHRvIG1pZ3JhdGUgbG9jYWwgZHJhZnRzOicsIGVycm9yKVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogR2V0IHJlYWwtdGltZSB0cmFja2luZyBzdGF0aXN0aWNzXHJcbiAgICovXHJcbiAgc3RhdGljIGFzeW5jIGdldFRyYWNraW5nU3RhdHModXNlcklkOiBzdHJpbmcgPSAnYW5vbnltb3VzJyk6IFByb21pc2U8e1xyXG4gICAgdG90YWxEcmFmdHM6IG51bWJlclxyXG4gICAgYXV0b1NhdmVkQ291bnQ6IG51bWJlclxyXG4gICAgbWFudWFsU2F2ZWRDb3VudDogbnVtYmVyXHJcbiAgICBhaVBvcHVsYXRlZENvdW50OiBudW1iZXJcclxuICB9PiB7XHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCBkcmFmdHMgPSBhd2FpdCB0aGlzLmdldEFsbERyYWZ0cyh1c2VySWQpXHJcbiAgICAgIFxyXG4gICAgICBjb25zdCBzdGF0cyA9IHtcclxuICAgICAgICB0b3RhbERyYWZ0czogZHJhZnRzLmxlbmd0aCxcclxuICAgICAgICBhdXRvU2F2ZWRDb3VudDogZHJhZnRzLmZpbHRlcihkID0+IGQuYXV0b1NhdmVkKS5sZW5ndGgsXHJcbiAgICAgICAgbWFudWFsU2F2ZWRDb3VudDogZHJhZnRzLmZpbHRlcihkID0+ICFkLmF1dG9TYXZlZCkubGVuZ3RoLFxyXG4gICAgICAgIGFpUG9wdWxhdGVkQ291bnQ6IGRyYWZ0cy5maWx0ZXIoZCA9PiBkLmFpUG9wdWxhdGVkRmllbGRzICYmIGQuYWlQb3B1bGF0ZWRGaWVsZHMubGVuZ3RoID4gMCkubGVuZ3RoXHJcbiAgICAgIH1cclxuICAgICAgXHJcbiAgICAgIHJldHVybiBzdGF0c1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRmFpbGVkIHRvIGdldCB0cmFja2luZyBzdGF0czonLCBlcnJvcilcclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICB0b3RhbERyYWZ0czogMCxcclxuICAgICAgICBhdXRvU2F2ZWRDb3VudDogMCxcclxuICAgICAgICBtYW51YWxTYXZlZENvdW50OiAwLFxyXG4gICAgICAgIGFpUG9wdWxhdGVkQ291bnQ6IDBcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxufSJdLCJuYW1lcyI6WyJjb2xsZWN0aW9uIiwiZG9jIiwiYWRkRG9jIiwidXBkYXRlRG9jIiwiZ2V0RG9jcyIsImdldERvYyIsIm9uU25hcHNob3QiLCJxdWVyeSIsIndoZXJlIiwib3JkZXJCeSIsInNlcnZlclRpbWVzdGFtcCIsInJlZiIsInVwbG9hZEJ5dGVzIiwiZ2V0RG93bmxvYWRVUkwiLCJkZWxldGVPYmplY3QiLCJkYiIsInN0b3JhZ2UiLCJGaXJlYmFzZURyYWZ0U2VydmljZSIsInRlc3RDb25uZWN0aW9uIiwiY29uc29sZSIsImxvZyIsInEiLCJDT0xMRUNUSU9OX05BTUUiLCJlcnJvciIsInNhdmVEcmFmdCIsImRhdGEiLCJpbWFnZUZpbGUiLCJkcmFmdERhdGEiLCJkcmFmdElkIiwiZ2VuZXJhdGVEcmFmdElkIiwiY3JlYXRpdmVGaWxlbmFtZSIsImxhc3RTYXZlZCIsImF1dG9TYXZlZCIsImZvcm1EYXRhIiwiYWlQb3B1bGF0ZWRGaWVsZHMiLCJ2ZXJzaW9uIiwiaXNBY3RpdmUiLCJ1c2VySWQiLCJpbWFnZURhdGEiLCJ1cGxvYWRJbWFnZSIsImltYWdlVXJsIiwiZG93bmxvYWRVcmwiLCJpbWFnZVN0b3JhZ2VQYXRoIiwic3RvcmFnZVBhdGgiLCJpZCIsImRyYWZ0UmVmIiwiY3JlYXRlZEF0IiwiZG9jUmVmIiwiRXJyb3IiLCJnZXREcmFmdCIsImRyYWZ0U25hcCIsImV4aXN0cyIsImdldEFsbERyYWZ0cyIsInF1ZXJ5U25hcHNob3QiLCJkcmFmdHMiLCJmb3JFYWNoIiwicHVzaCIsImRlbGV0ZURyYWZ0IiwiZGVsZXRlSW1hZ2UiLCJvbkRyYWZ0c0NoYW5nZSIsImNhbGxiYWNrIiwib25EcmFmdENoYW5nZSIsImZpbGUiLCJTVE9SQUdFX1BBVEgiLCJuYW1lIiwiaW1hZ2VSZWYiLCJNYXRoIiwiRGF0ZSIsIm5vdyIsInJhbmRvbSIsInRvU3RyaW5nIiwic3Vic3RyIiwibWlncmF0ZUxvY2FsRHJhZnRzIiwiRHJhZnRTdG9yYWdlVjIiLCJsb2NhbERyYWZ0cyIsImxlbmd0aCIsImxvY2FsRHJhZnQiLCJmaXJlYmFzZURyYWZ0IiwiZ2V0VHJhY2tpbmdTdGF0cyIsInN0YXRzIiwidG90YWxEcmFmdHMiLCJhdXRvU2F2ZWRDb3VudCIsImZpbHRlciIsImQiLCJtYW51YWxTYXZlZENvdW50IiwiYWlQb3B1bGF0ZWRDb3VudCJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(app-pages-browser)/./lib/firebase-draft-service.ts\n"));

/***/ })

});