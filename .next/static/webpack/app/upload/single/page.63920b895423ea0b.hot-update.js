"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
self["webpackHotUpdate_N_E"]("app/upload/single/page",{

/***/ "(app-pages-browser)/./lib/firebase-draft-service.ts":
/*!***************************************!*\
  !*** ./lib/firebase-draft-service.ts ***!
  \***************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval(__webpack_require__.ts("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   FirebaseDraftService: () => (/* binding */ FirebaseDraftService)\n/* harmony export */ });\n/* harmony import */ var firebase_firestore__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! firebase/firestore */ \"(app-pages-browser)/./node_modules/firebase/firestore/dist/esm/index.esm.js\");\n/* harmony import */ var firebase_storage__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! firebase/storage */ \"(app-pages-browser)/./node_modules/firebase/storage/dist/esm/index.esm.js\");\n/* harmony import */ var _firebase__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./firebase */ \"(app-pages-browser)/./lib/firebase.ts\");\n// Firebase Draft Service - Real-time draft management with Firestore\n\n\n\nclass FirebaseDraftService {\n    /**\r\n   * Test Firebase connection\r\n   */ static async testConnection() {\n        try {\n            console.log('🔥 Testing Firebase connection...');\n            // Try to read from Firestore\n            const q = (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_0__.query)((0,firebase_firestore__WEBPACK_IMPORTED_MODULE_0__.collection)(_firebase__WEBPACK_IMPORTED_MODULE_2__.db, this.COLLECTION_NAME), (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_0__.where)('isActive', '==', true));\n            await (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_0__.getDocs)(q);\n            console.log('✅ Firebase connection test successful');\n            return true;\n        } catch (error) {\n            console.error('❌ Firebase connection test failed:', error);\n            return false;\n        }\n    }\n    /**\r\n   * Save or update a draft in Firestore\r\n   */ static async saveDraft(data, imageFile) {\n        try {\n            console.log('🔥 Firebase saveDraft called with data:', data);\n            // Clean the formData to remove non-serializable objects like File\n            const cleanFormData = {\n                ...data.formData\n            };\n            if (cleanFormData.uploadedImage) {\n                // Store only file metadata, not the actual File object\n                const file = cleanFormData.uploadedImage;\n                cleanFormData.uploadedImage = {\n                    name: file.name,\n                    size: file.size,\n                    type: file.type,\n                    lastModified: file.lastModified,\n                    isFileObject: true // Flag to identify this was a file\n                };\n            }\n            const draftData = {\n                draftId: data.draftId || this.generateDraftId(),\n                creativeFilename: data.creativeFilename || 'Untitled',\n                lastSaved: (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_0__.serverTimestamp)(),\n                autoSaved: data.autoSaved || false,\n                formData: cleanFormData,\n                aiPopulatedFields: data.aiPopulatedFields || [],\n                version: (data.version || 0) + 1,\n                isActive: true,\n                userId: data.userId || 'anonymous' // In production, use actual user ID\n            };\n            console.log('🔥 Prepared draft data for Firebase:', draftData);\n            // Handle image upload if provided (skip if storage permission issues)\n            if (imageFile) {\n                try {\n                    const imageData = await this.uploadImage(imageFile, draftData.draftId);\n                    draftData.imageUrl = imageData.downloadUrl;\n                    draftData.imageStoragePath = imageData.storagePath;\n                    console.log('✅ Image uploaded successfully');\n                } catch (imageError) {\n                    console.warn('⚠️ Image upload failed, continuing without image:', imageError);\n                // Don't fail the entire draft save if image upload fails\n                }\n            }\n            // If draftId exists, update existing document\n            if (data.id) {\n                console.log('🔥 Updating existing draft with ID:', data.id);\n                const draftRef = (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_0__.doc)(_firebase__WEBPACK_IMPORTED_MODULE_2__.db, this.COLLECTION_NAME, data.id);\n                await (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_0__.updateDoc)(draftRef, {\n                    ...draftData,\n                    lastSaved: (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_0__.serverTimestamp)()\n                });\n                console.log('✅ Draft updated successfully:', data.id);\n                return data.id;\n            } else {\n                // Create new draft\n                console.log('🔥 Creating new draft document');\n                draftData.createdAt = (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_0__.serverTimestamp)();\n                const docRef = await (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_0__.addDoc)((0,firebase_firestore__WEBPACK_IMPORTED_MODULE_0__.collection)(_firebase__WEBPACK_IMPORTED_MODULE_2__.db, this.COLLECTION_NAME), draftData);\n                console.log('✅ New draft created with ID:', docRef.id);\n                return docRef.id;\n            }\n        } catch (error) {\n            console.error('❌ Failed to save draft to Firebase:', error);\n            console.error('Firebase error details:', error);\n            throw new Error(\"Failed to save draft: \".concat(error));\n        }\n    }\n    /**\r\n   * Get a single draft by ID\r\n   */ static async getDraft(id) {\n        try {\n            const draftRef = (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_0__.doc)(_firebase__WEBPACK_IMPORTED_MODULE_2__.db, this.COLLECTION_NAME, id);\n            const draftSnap = await (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_0__.getDoc)(draftRef);\n            if (draftSnap.exists()) {\n                return {\n                    id: draftSnap.id,\n                    ...draftSnap.data()\n                };\n            }\n            return null;\n        } catch (error) {\n            console.error('Failed to get draft:', error);\n            return null;\n        }\n    }\n    /**\r\n   * Get all active drafts for a user\r\n   */ static async getAllDrafts() {\n        let userId = arguments.length > 0 && arguments[0] !== void 0 ? arguments[0] : 'anonymous';\n        try {\n            // Simplified query to avoid needing a composite index\n            const q = (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_0__.query)((0,firebase_firestore__WEBPACK_IMPORTED_MODULE_0__.collection)(_firebase__WEBPACK_IMPORTED_MODULE_2__.db, this.COLLECTION_NAME), (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_0__.where)('userId', '==', userId), (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_0__.where)('isActive', '==', true));\n            const querySnapshot = await (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_0__.getDocs)(q);\n            const drafts = [];\n            querySnapshot.forEach((doc)=>{\n                drafts.push({\n                    id: doc.id,\n                    ...doc.data()\n                });\n            });\n            // Sort by lastSaved in memory to avoid needing a composite index\n            return drafts.sort((a, b)=>{\n                var _a_lastSaved_toDate, _a_lastSaved_toDate1, _a_lastSaved, _b_lastSaved_toDate, _b_lastSaved_toDate1, _b_lastSaved;\n                const aTime = ((_a_lastSaved = a.lastSaved) === null || _a_lastSaved === void 0 ? void 0 : (_a_lastSaved_toDate1 = _a_lastSaved.toDate) === null || _a_lastSaved_toDate1 === void 0 ? void 0 : (_a_lastSaved_toDate = _a_lastSaved_toDate1.call(_a_lastSaved)) === null || _a_lastSaved_toDate === void 0 ? void 0 : _a_lastSaved_toDate.getTime()) || 0;\n                const bTime = ((_b_lastSaved = b.lastSaved) === null || _b_lastSaved === void 0 ? void 0 : (_b_lastSaved_toDate1 = _b_lastSaved.toDate) === null || _b_lastSaved_toDate1 === void 0 ? void 0 : (_b_lastSaved_toDate = _b_lastSaved_toDate1.call(_b_lastSaved)) === null || _b_lastSaved_toDate === void 0 ? void 0 : _b_lastSaved_toDate.getTime()) || 0;\n                return bTime - aTime // Desc order\n                ;\n            });\n        } catch (error) {\n            console.error('Failed to get drafts:', error);\n            return [];\n        }\n    }\n    /**\r\n   * Delete a draft (soft delete by marking as inactive)\r\n   */ static async deleteDraft(id) {\n        try {\n            const draftRef = (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_0__.doc)(_firebase__WEBPACK_IMPORTED_MODULE_2__.db, this.COLLECTION_NAME, id);\n            // Get draft data to clean up image if needed\n            const draftSnap = await (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_0__.getDoc)(draftRef);\n            if (draftSnap.exists()) {\n                const draftData = draftSnap.data();\n                // Delete image from storage if exists\n                if (draftData.imageStoragePath) {\n                    await this.deleteImage(draftData.imageStoragePath);\n                }\n            }\n            // Soft delete by marking as inactive\n            await (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_0__.updateDoc)(draftRef, {\n                isActive: false,\n                lastSaved: (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_0__.serverTimestamp)()\n            });\n            return true;\n        } catch (error) {\n            console.error('Failed to delete draft:', error);\n            return false;\n        }\n    }\n    /**\r\n   * Set up real-time listener for drafts\r\n   */ static onDraftsChange() {\n        let userId = arguments.length > 0 && arguments[0] !== void 0 ? arguments[0] : 'anonymous', callback = arguments.length > 1 ? arguments[1] : void 0;\n        // Simplified query to avoid needing a composite index\n        const q = (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_0__.query)((0,firebase_firestore__WEBPACK_IMPORTED_MODULE_0__.collection)(_firebase__WEBPACK_IMPORTED_MODULE_2__.db, this.COLLECTION_NAME), (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_0__.where)('userId', '==', userId), (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_0__.where)('isActive', '==', true));\n        return (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_0__.onSnapshot)(q, (querySnapshot)=>{\n            const drafts = [];\n            querySnapshot.forEach((doc)=>{\n                drafts.push({\n                    id: doc.id,\n                    ...doc.data()\n                });\n            });\n            // Sort by lastSaved in memory to avoid needing a composite index\n            const sortedDrafts = drafts.sort((a, b)=>{\n                var _a_lastSaved_toDate, _a_lastSaved_toDate1, _a_lastSaved, _b_lastSaved_toDate, _b_lastSaved_toDate1, _b_lastSaved;\n                const aTime = ((_a_lastSaved = a.lastSaved) === null || _a_lastSaved === void 0 ? void 0 : (_a_lastSaved_toDate1 = _a_lastSaved.toDate) === null || _a_lastSaved_toDate1 === void 0 ? void 0 : (_a_lastSaved_toDate = _a_lastSaved_toDate1.call(_a_lastSaved)) === null || _a_lastSaved_toDate === void 0 ? void 0 : _a_lastSaved_toDate.getTime()) || 0;\n                const bTime = ((_b_lastSaved = b.lastSaved) === null || _b_lastSaved === void 0 ? void 0 : (_b_lastSaved_toDate1 = _b_lastSaved.toDate) === null || _b_lastSaved_toDate1 === void 0 ? void 0 : (_b_lastSaved_toDate = _b_lastSaved_toDate1.call(_b_lastSaved)) === null || _b_lastSaved_toDate === void 0 ? void 0 : _b_lastSaved_toDate.getTime()) || 0;\n                return bTime - aTime // Desc order\n                ;\n            });\n            callback(sortedDrafts);\n        }, (error)=>{\n            console.error('Real-time drafts listener error:', error);\n        });\n    }\n    /**\r\n   * Set up real-time listener for a specific draft\r\n   */ static onDraftChange(draftId, callback) {\n        const draftRef = (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_0__.doc)(_firebase__WEBPACK_IMPORTED_MODULE_2__.db, this.COLLECTION_NAME, draftId);\n        return (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_0__.onSnapshot)(draftRef, (doc)=>{\n            if (doc.exists()) {\n                callback({\n                    id: doc.id,\n                    ...doc.data()\n                });\n            } else {\n                callback(null);\n            }\n        }, (error)=>{\n            console.error('Real-time draft listener error:', error);\n        });\n    }\n    /**\r\n   * Upload image to Firebase Storage\r\n   */ static async uploadImage(file, draftId) {\n        try {\n            const storagePath = \"\".concat(this.STORAGE_PATH, \"/\").concat(draftId, \"/\").concat(file.name);\n            const imageRef = (0,firebase_storage__WEBPACK_IMPORTED_MODULE_1__.ref)(_firebase__WEBPACK_IMPORTED_MODULE_2__.storage, storagePath);\n            await (0,firebase_storage__WEBPACK_IMPORTED_MODULE_1__.uploadBytes)(imageRef, file);\n            const downloadUrl = await (0,firebase_storage__WEBPACK_IMPORTED_MODULE_1__.getDownloadURL)(imageRef);\n            return {\n                downloadUrl,\n                storagePath\n            };\n        } catch (error) {\n            console.error('Failed to upload image:', error);\n            throw new Error('Failed to upload image');\n        }\n    }\n    /**\r\n   * Delete image from Firebase Storage\r\n   */ static async deleteImage(storagePath) {\n        try {\n            const imageRef = (0,firebase_storage__WEBPACK_IMPORTED_MODULE_1__.ref)(_firebase__WEBPACK_IMPORTED_MODULE_2__.storage, storagePath);\n            await (0,firebase_storage__WEBPACK_IMPORTED_MODULE_1__.deleteObject)(imageRef);\n        } catch (error) {\n            console.error('Failed to delete image:', error);\n        // Don't throw error as this is cleanup\n        }\n    }\n    /**\r\n   * Generate unique draft ID\r\n   */ static generateDraftId() {\n        return \"draft_\".concat(Date.now(), \"_\").concat(Math.random().toString(36).substr(2, 9));\n    }\n    /**\r\n   * Migrate existing localStorage drafts to Firebase\r\n   */ static async migrateLocalDrafts() {\n        try {\n            // Import the existing draft storage to access local drafts\n            const { DraftStorageV2 } = await __webpack_require__.e(/*! import() */ \"_app-pages-browser_utils_draftStorage_v2_ts\").then(__webpack_require__.bind(__webpack_require__, /*! ../utils/draftStorage.v2 */ \"(app-pages-browser)/./utils/draftStorage.v2.ts\"));\n            const localDrafts = DraftStorageV2.getAllDrafts();\n            console.log(\"Found \".concat(localDrafts.length, \" local drafts to migrate\"));\n            for (const localDraft of localDrafts){\n                try {\n                    const firebaseDraft = {\n                        draftId: localDraft.draftId,\n                        creativeFilename: localDraft.creativeFilename,\n                        formData: localDraft.formData,\n                        autoSaved: localDraft.autoSaved,\n                        version: 1,\n                        isActive: true\n                    };\n                    await this.saveDraft(firebaseDraft);\n                    console.log(\"Migrated draft: \".concat(localDraft.creativeFilename));\n                } catch (error) {\n                    console.error(\"Failed to migrate draft \".concat(localDraft.draftId, \":\"), error);\n                }\n            }\n            console.log('Draft migration completed');\n        } catch (error) {\n            console.error('Failed to migrate local drafts:', error);\n        }\n    }\n    /**\r\n   * Get real-time tracking statistics\r\n   */ static async getTrackingStats() {\n        let userId = arguments.length > 0 && arguments[0] !== void 0 ? arguments[0] : 'anonymous';\n        try {\n            const drafts = await this.getAllDrafts(userId);\n            const stats = {\n                totalDrafts: drafts.length,\n                autoSavedCount: drafts.filter((d)=>d.autoSaved).length,\n                manualSavedCount: drafts.filter((d)=>!d.autoSaved).length,\n                aiPopulatedCount: drafts.filter((d)=>d.aiPopulatedFields && d.aiPopulatedFields.length > 0).length\n            };\n            return stats;\n        } catch (error) {\n            console.error('Failed to get tracking stats:', error);\n            return {\n                totalDrafts: 0,\n                autoSavedCount: 0,\n                manualSavedCount: 0,\n                aiPopulatedCount: 0\n            };\n        }\n    }\n}\nFirebaseDraftService.COLLECTION_NAME = 'drafts';\nFirebaseDraftService.STORAGE_PATH = 'draft-images';\n\n\n;\n    // Wrapped in an IIFE to avoid polluting the global scope\n    ;\n    (function () {\n        var _a, _b;\n        // Legacy CSS implementations will `eval` browser code in a Node.js context\n        // to extract CSS. For backwards compatibility, we need to check we're in a\n        // browser context before continuing.\n        if (typeof self !== 'undefined' &&\n            // AMP / No-JS mode does not inject these helpers:\n            '$RefreshHelpers$' in self) {\n            // @ts-ignore __webpack_module__ is global\n            var currentExports = module.exports;\n            // @ts-ignore __webpack_module__ is global\n            var prevSignature = (_b = (_a = module.hot.data) === null || _a === void 0 ? void 0 : _a.prevSignature) !== null && _b !== void 0 ? _b : null;\n            // This cannot happen in MainTemplate because the exports mismatch between\n            // templating and execution.\n            self.$RefreshHelpers$.registerExportsForReactRefresh(currentExports, module.id);\n            // A module can be accepted automatically based on its exports, e.g. when\n            // it is a Refresh Boundary.\n            if (self.$RefreshHelpers$.isReactRefreshBoundary(currentExports)) {\n                // Save the previous exports signature on update so we can compare the boundary\n                // signatures. We avoid saving exports themselves since it causes memory leaks (https://github.com/vercel/next.js/pull/53797)\n                module.hot.dispose(function (data) {\n                    data.prevSignature =\n                        self.$RefreshHelpers$.getRefreshBoundarySignature(currentExports);\n                });\n                // Unconditionally accept an update to this module, we'll check if it's\n                // still a Refresh Boundary later.\n                // @ts-ignore importMeta is replaced in the loader\n                module.hot.accept();\n                // This field is set when the previous version of this module was a\n                // Refresh Boundary, letting us know we need to check for invalidation or\n                // enqueue an update.\n                if (prevSignature !== null) {\n                    // A boundary can become ineligible if its exports are incompatible\n                    // with the previous exports.\n                    //\n                    // For example, if you add/remove/change exports, we'll want to\n                    // re-execute the importing modules, and force those components to\n                    // re-render. Similarly, if you convert a class component to a\n                    // function, we want to invalidate the boundary.\n                    if (self.$RefreshHelpers$.shouldInvalidateReactRefreshBoundary(prevSignature, self.$RefreshHelpers$.getRefreshBoundarySignature(currentExports))) {\n                        module.hot.invalidate();\n                    }\n                    else {\n                        self.$RefreshHelpers$.scheduleUpdate();\n                    }\n                }\n            }\n            else {\n                // Since we just executed the code for the module, it's possible that the\n                // new exports made it ineligible for being a boundary.\n                // We only care about the case when we were _previously_ a boundary,\n                // because we already accepted this update (accidental side effect).\n                var isNoLongerABoundary = prevSignature !== null;\n                if (isNoLongerABoundary) {\n                    module.hot.invalidate();\n                }\n            }\n        }\n    })();\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwcC1wYWdlcy1icm93c2VyKS8uL2xpYi9maXJlYmFzZS1kcmFmdC1zZXJ2aWNlLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBQSxxRUFBcUU7QUFlMUM7QUFDc0Q7QUFDekM7QUFtQmpDLE1BQU1nQjtJQUlYOztHQUVDLEdBQ0QsYUFBYUMsaUJBQW1DO1FBQzlDLElBQUk7WUFDRkMsUUFBUUMsR0FBRyxDQUFDO1lBQ1osNkJBQTZCO1lBQzdCLE1BQU1DLElBQUliLHlEQUFLQSxDQUFDUCw4REFBVUEsQ0FBQ2MseUNBQUVBLEVBQUUsSUFBSSxDQUFDTyxlQUFlLEdBQUdiLHlEQUFLQSxDQUFDLFlBQVksTUFBTTtZQUM5RSxNQUFNSiwyREFBT0EsQ0FBQ2dCO1lBQ2RGLFFBQVFDLEdBQUcsQ0FBQztZQUNaLE9BQU87UUFDVCxFQUFFLE9BQU9HLE9BQU87WUFDZEosUUFBUUksS0FBSyxDQUFDLHNDQUFzQ0E7WUFDcEQsT0FBTztRQUNUO0lBQ0Y7SUFFQTs7R0FFQyxHQUNELGFBQWFDLFVBQVVDLElBQWdDLEVBQUVDLFNBQWdCLEVBQW1CO1FBQzFGLElBQUk7WUFDRlAsUUFBUUMsR0FBRyxDQUFDLDJDQUEyQ0s7WUFFdkQsa0VBQWtFO1lBQ2xFLE1BQU1FLGdCQUFnQjtnQkFBRSxHQUFHRixLQUFLRyxRQUFRO1lBQUM7WUFDekMsSUFBSUQsY0FBY0UsYUFBYSxFQUFFO2dCQUMvQix1REFBdUQ7Z0JBQ3ZELE1BQU1DLE9BQU9ILGNBQWNFLGFBQWE7Z0JBQ3hDRixjQUFjRSxhQUFhLEdBQUc7b0JBQzVCRSxNQUFNRCxLQUFLQyxJQUFJO29CQUNmQyxNQUFNRixLQUFLRSxJQUFJO29CQUNmQyxNQUFNSCxLQUFLRyxJQUFJO29CQUNmQyxjQUFjSixLQUFLSSxZQUFZO29CQUMvQkMsY0FBYyxLQUFLLG1DQUFtQztnQkFDeEQ7WUFDRjtZQUVBLE1BQU1DLFlBQXdDO2dCQUM1Q0MsU0FBU1osS0FBS1ksT0FBTyxJQUFJLElBQUksQ0FBQ0MsZUFBZTtnQkFDN0NDLGtCQUFr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O29CQUNkSixRQUFRSSxLQUFLLENBQUMsMkJBQThDLE9BQW5CcUUsV0FBV3ZELE9BQU8sRUFBQyxNQUFJZDtnQkFDbEU7WUFDRjtZQUVBSixRQUFRQyxHQUFHLENBQUM7UUFDZCxFQUFFLE9BQU9HLE9BQU87WUFDZEosUUFBUUksS0FBSyxDQUFDLG1DQUFtQ0E7UUFDbkQ7SUFDRjtJQUVBOztHQUVDLEdBQ0QsYUFBYXVFLG1CQUtWO1lBTDJCakQsU0FBQUEsaUVBQWlCO1FBTTdDLElBQUk7WUFDRixNQUFNbUIsU0FBUyxNQUFNLElBQUksQ0FBQ0YsWUFBWSxDQUFDakI7WUFFdkMsTUFBTWtELFFBQVE7Z0JBQ1pDLGFBQWFoQyxPQUFPMkIsTUFBTTtnQkFDMUJNLGdCQUFnQmpDLE9BQU9rQyxNQUFNLENBQUNDLENBQUFBLElBQUtBLEVBQUUxRCxTQUFTLEVBQUVrRCxNQUFNO2dCQUN0RFMsa0JBQWtCcEMsT0FBT2tDLE1BQU0sQ0FBQ0MsQ0FBQUEsSUFBSyxDQUFDQSxFQUFFMUQsU0FBUyxFQUFFa0QsTUFBTTtnQkFDekRVLGtCQUFrQnJDLE9BQU9rQyxNQUFNLENBQUNDLENBQUFBLElBQUtBLEVBQUV6RCxpQkFBaUIsSUFBSXlELEVBQUV6RCxpQkFBaUIsQ0FBQ2lELE1BQU0sR0FBRyxHQUFHQSxNQUFNO1lBQ3BHO1lBRUEsT0FBT0k7UUFDVCxFQUFFLE9BQU94RSxPQUFPO1lBQ2RKLFFBQVFJLEtBQUssQ0FBQyxpQ0FBaUNBO1lBQy9DLE9BQU87Z0JBQ0x5RSxhQUFhO2dCQUNiQyxnQkFBZ0I7Z0JBQ2hCRyxrQkFBa0I7Z0JBQ2xCQyxrQkFBa0I7WUFDcEI7UUFDRjtJQUNGO0FBQ0Y7QUFoVmFwRixxQkFDYUssa0JBQWtCO0FBRC9CTCxxQkFFYStELGVBQWUiLCJzb3VyY2VzIjpbIkQ6XFxJc3RpYW4gRmlsZXNcXFRpc2VnXFxDUlkgQXBwXFxsaWJcXGZpcmViYXNlLWRyYWZ0LXNlcnZpY2UudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gRmlyZWJhc2UgRHJhZnQgU2VydmljZSAtIFJlYWwtdGltZSBkcmFmdCBtYW5hZ2VtZW50IHdpdGggRmlyZXN0b3JlXHJcbmltcG9ydCB7IFxyXG4gIGNvbGxlY3Rpb24sIFxyXG4gIGRvYywgXHJcbiAgYWRkRG9jLCBcclxuICB1cGRhdGVEb2MsIFxyXG4gIGRlbGV0ZURvYywgXHJcbiAgZ2V0RG9jcywgXHJcbiAgZ2V0RG9jLFxyXG4gIG9uU25hcHNob3QsXHJcbiAgcXVlcnksXHJcbiAgd2hlcmUsXHJcbiAgb3JkZXJCeSxcclxuICBUaW1lc3RhbXAsXHJcbiAgc2VydmVyVGltZXN0YW1wXHJcbn0gZnJvbSAnZmlyZWJhc2UvZmlyZXN0b3JlJ1xyXG5pbXBvcnQgeyByZWYsIHVwbG9hZEJ5dGVzLCBnZXREb3dubG9hZFVSTCwgZGVsZXRlT2JqZWN0IH0gZnJvbSAnZmlyZWJhc2Uvc3RvcmFnZSdcclxuaW1wb3J0IHsgZGIsIHN0b3JhZ2UgfSBmcm9tICcuL2ZpcmViYXNlJ1xyXG5cclxuZXhwb3J0IGludGVyZmFjZSBGaXJlYmFzZURyYWZ0RGF0YSB7XHJcbiAgaWQ/OiBzdHJpbmdcclxuICBkcmFmdElkOiBzdHJpbmdcclxuICBjcmVhdGl2ZUZpbGVuYW1lOiBzdHJpbmdcclxuICBsYXN0U2F2ZWQ6IFRpbWVzdGFtcFxyXG4gIGNyZWF0ZWRBdDogVGltZXN0YW1wXHJcbiAgYXV0b1NhdmVkPzogYm9vbGVhblxyXG4gIGZvcm1EYXRhOiBhbnlcclxuICBpbWFnZVVybD86IHN0cmluZ1xyXG4gIGltYWdlU3RvcmFnZVBhdGg/OiBzdHJpbmdcclxuICB1c2VySWQ/OiBzdHJpbmdcclxuICAvLyBBZGRpdGlvbmFsIHRyYWNraW5nIGZpZWxkcyBhcyBwZXIgcmVxdWlyZW1lbnRzXHJcbiAgYWlQb3B1bGF0ZWRGaWVsZHM/OiBzdHJpbmdbXVxyXG4gIHZlcnNpb246IG51bWJlclxyXG4gIGlzQWN0aXZlOiBib29sZWFuXHJcbn1cclxuXHJcbmV4cG9ydCBjbGFzcyBGaXJlYmFzZURyYWZ0U2VydmljZSB7XHJcbiAgcHJpdmF0ZSBzdGF0aWMgcmVhZG9ubHkgQ09MTEVDVElPTl9OQU1FID0gJ2RyYWZ0cydcclxuICBwcml2YXRlIHN0YXRpYyByZWFkb25seSBTVE9SQUdFX1BBVEggPSAnZHJhZnQtaW1hZ2VzJ1xyXG5cclxuICAvKipcclxuICAgKiBUZXN0IEZpcmViYXNlIGNvbm5lY3Rpb25cclxuICAgKi9cclxuICBzdGF0aWMgYXN5bmMgdGVzdENvbm5lY3Rpb24oKTogUHJvbWlzZTxib29sZWFuPiB7XHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zb2xlLmxvZygn8J+UpSBUZXN0aW5nIEZpcmViYXNlIGNvbm5lY3Rpb24uLi4nKVxyXG4gICAgICAvLyBUcnkgdG8gcmVhZCBmcm9tIEZpcmVzdG9yZVxyXG4gICAgICBjb25zdCBxID0gcXVlcnkoY29sbGVjdGlvbihkYiwgdGhpcy5DT0xMRUNUSU9OX05BTUUpLCB3aGVyZSgnaXNBY3RpdmUnLCAnPT0nLCB0cnVlKSlcclxuICAgICAgYXdhaXQgZ2V0RG9jcyhxKVxyXG4gICAgICBjb25zb2xlLmxvZygn4pyFIEZpcmViYXNlIGNvbm5lY3Rpb24gdGVzdCBzdWNjZXNzZnVsJylcclxuICAgICAgcmV0dXJuIHRydWVcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBGaXJlYmFzZSBjb25uZWN0aW9uIHRlc3QgZmFpbGVkOicsIGVycm9yKVxyXG4gICAgICByZXR1cm4gZmFsc2VcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFNhdmUgb3IgdXBkYXRlIGEgZHJhZnQgaW4gRmlyZXN0b3JlXHJcbiAgICovXHJcbiAgc3RhdGljIGFzeW5jIHNhdmVEcmFmdChkYXRhOiBQYXJ0aWFsPEZpcmViYXNlRHJhZnREYXRhPiwgaW1hZ2VGaWxlPzogRmlsZSk6IFByb21pc2U8c3RyaW5nPiB7XHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zb2xlLmxvZygn8J+UpSBGaXJlYmFzZSBzYXZlRHJhZnQgY2FsbGVkIHdpdGggZGF0YTonLCBkYXRhKVxyXG4gICAgICBcclxuICAgICAgLy8gQ2xlYW4gdGhlIGZvcm1EYXRhIHRvIHJlbW92ZSBub24tc2VyaWFsaXphYmxlIG9iamVjdHMgbGlrZSBGaWxlXHJcbiAgICAgIGNvbnN0IGNsZWFuRm9ybURhdGEgPSB7IC4uLmRhdGEuZm9ybURhdGEgfVxyXG4gICAgICBpZiAoY2xlYW5Gb3JtRGF0YS51cGxvYWRlZEltYWdlKSB7XHJcbiAgICAgICAgLy8gU3RvcmUgb25seSBmaWxlIG1ldGFkYXRhLCBub3QgdGhlIGFjdHVhbCBGaWxlIG9iamVjdFxyXG4gICAgICAgIGNvbnN0IGZpbGUgPSBjbGVhbkZvcm1EYXRhLnVwbG9hZGVkSW1hZ2UgYXMgRmlsZVxyXG4gICAgICAgIGNsZWFuRm9ybURhdGEudXBsb2FkZWRJbWFnZSA9IHtcclxuICAgICAgICAgIG5hbWU6IGZpbGUubmFtZSxcclxuICAgICAgICAgIHNpemU6IGZpbGUuc2l6ZSxcclxuICAgICAgICAgIHR5cGU6IGZpbGUudHlwZSxcclxuICAgICAgICAgIGxhc3RNb2RpZmllZDogZmlsZS5sYXN0TW9kaWZpZWQsXHJcbiAgICAgICAgICBpc0ZpbGVPYmplY3Q6IHRydWUgLy8gRmxhZyB0byBpZGVudGlmeSB0aGlzIHdhcyBhIGZpbGVcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgICAgXHJcbiAgICAgIGNvbnN0IGRyYWZ0RGF0YTogUGFydGlhbDxGaXJlYmFzZURyYWZ0RGF0YT4gPSB7XHJcbiAgICAgICAgZHJhZnRJZDogZGF0YS5kcmFmdElkIHx8IHRoaXMuZ2VuZXJhdGVEcmFmdElkKCksXHJcbiAgICAgICAgY3JlYXRpdmVGaWxlbmFtZTogZGF0YS5jcmVhdGl2ZUZpbGVuYW1lIHx8ICdVbnRpdGxlZCcsXHJcbiAgICAgICAgbGFzdFNhdmVkOiBzZXJ2ZXJUaW1lc3RhbXAoKSBhcyBUaW1lc3RhbXAsXHJcbiAgICAgICAgYXV0b1NhdmVkOiBkYXRhLmF1dG9TYXZlZCB8fCBmYWxzZSxcclxuICAgICAgICBmb3JtRGF0YTogY2xlYW5Gb3JtRGF0YSxcclxuICAgICAgICBhaVBvcHVsYXRlZEZpZWxkczogZGF0YS5haVBvcHVsYXRlZEZpZWxkcyB8fCBbXSxcclxuICAgICAgICB2ZXJzaW9uOiAoZGF0YS52ZXJzaW9uIHx8IDApICsgMSxcclxuICAgICAgICBpc0FjdGl2ZTogdHJ1ZSxcclxuICAgICAgICB1c2VySWQ6IGRhdGEudXNlcklkIHx8ICdhbm9ueW1vdXMnIC8vIEluIHByb2R1Y3Rpb24sIHVzZSBhY3R1YWwgdXNlciBJRFxyXG4gICAgICB9XHJcblxyXG4gICAgICBjb25zb2xlLmxvZygn8J+UpSBQcmVwYXJlZCBkcmFmdCBkYXRhIGZvciBGaXJlYmFzZTonLCBkcmFmdERhdGEpXHJcblxyXG4gICAgICAvLyBIYW5kbGUgaW1hZ2UgdXBsb2FkIGlmIHByb3ZpZGVkIChza2lwIGlmIHN0b3JhZ2UgcGVybWlzc2lvbiBpc3N1ZXMpXHJcbiAgICAgIGlmIChpbWFnZUZpbGUpIHtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgY29uc3QgaW1hZ2VEYXRhID0gYXdhaXQgdGhpcy51cGxvYWRJbWFnZShpbWFnZUZpbGUsIGRyYWZ0RGF0YS5kcmFmdElkISlcclxuICAgICAgICAgIGRyYWZ0RGF0YS5pbWFnZVVybCA9IGltYWdlRGF0YS5kb3dubG9hZFVybFxyXG4gICAgICAgICAgZHJhZnREYXRhLmltYWdlU3RvcmFnZVBhdGggPSBpbWFnZURhdGEuc3RvcmFnZVBhdGhcclxuICAgICAgICAgIGNvbnNvbGUubG9nKCfinIUgSW1hZ2UgdXBsb2FkZWQgc3VjY2Vzc2Z1bGx5JylcclxuICAgICAgICB9IGNhdGNoIChpbWFnZUVycm9yKSB7XHJcbiAgICAgICAgICBjb25zb2xlLndhcm4oJ+KaoO+4jyBJbWFnZSB1cGxvYWQgZmFpbGVkLCBjb250aW51aW5nIHdpdGhvdXQgaW1hZ2U6JywgaW1hZ2VFcnJvcilcclxuICAgICAgICAgIC8vIERvbid0IGZhaWwgdGhlIGVudGlyZSBkcmFmdCBzYXZlIGlmIGltYWdlIHVwbG9hZCBmYWlsc1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gSWYgZHJhZnRJZCBleGlzdHMsIHVwZGF0ZSBleGlzdGluZyBkb2N1bWVudFxyXG4gICAgICBpZiAoZGF0YS5pZCkge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKCfwn5SlIFVwZGF0aW5nIGV4aXN0aW5nIGRyYWZ0IHdpdGggSUQ6JywgZGF0YS5pZClcclxuICAgICAgICBjb25zdCBkcmFmdFJlZiA9IGRvYyhkYiwgdGhpcy5DT0xMRUNUSU9OX05BTUUsIGRhdGEuaWQpXHJcbiAgICAgICAgYXdhaXQgdXBkYXRlRG9jKGRyYWZ0UmVmLCB7XHJcbiAgICAgICAgICAuLi5kcmFmdERhdGEsXHJcbiAgICAgICAgICBsYXN0U2F2ZWQ6IHNlcnZlclRpbWVzdGFtcCgpXHJcbiAgICAgICAgfSlcclxuICAgICAgICBjb25zb2xlLmxvZygn4pyFIERyYWZ0IHVwZGF0ZWQgc3VjY2Vzc2Z1bGx5OicsIGRhdGEuaWQpXHJcbiAgICAgICAgcmV0dXJuIGRhdGEuaWRcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICAvLyBDcmVhdGUgbmV3IGRyYWZ0XHJcbiAgICAgICAgY29uc29sZS5sb2coJ/CflKUgQ3JlYXRpbmcgbmV3IGRyYWZ0IGRvY3VtZW50JylcclxuICAgICAgICBkcmFmdERhdGEuY3JlYXRlZEF0ID0gc2VydmVyVGltZXN0YW1wKCkgYXMgVGltZXN0YW1wXHJcbiAgICAgICAgY29uc3QgZG9jUmVmID0gYXdhaXQgYWRkRG9jKGNvbGxlY3Rpb24oZGIsIHRoaXMuQ09MTEVDVElPTl9OQU1FKSwgZHJhZnREYXRhKVxyXG4gICAgICAgIGNvbnNvbGUubG9nKCfinIUgTmV3IGRyYWZ0IGNyZWF0ZWQgd2l0aCBJRDonLCBkb2NSZWYuaWQpXHJcbiAgICAgICAgcmV0dXJuIGRvY1JlZi5pZFxyXG4gICAgICB9XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCfinYwgRmFpbGVkIHRvIHNhdmUgZHJhZnQgdG8gRmlyZWJhc2U6JywgZXJyb3IpXHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0ZpcmViYXNlIGVycm9yIGRldGFpbHM6JywgZXJyb3IpXHJcbiAgICAgIHRocm93IG5ldyBFcnJvcihgRmFpbGVkIHRvIHNhdmUgZHJhZnQ6ICR7ZXJyb3J9YClcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEdldCBhIHNpbmdsZSBkcmFmdCBieSBJRFxyXG4gICAqL1xyXG4gIHN0YXRpYyBhc3luYyBnZXREcmFmdChpZDogc3RyaW5nKTogUHJvbWlzZTxGaXJlYmFzZURyYWZ0RGF0YSB8IG51bGw+IHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IGRyYWZ0UmVmID0gZG9jKGRiLCB0aGlzLkNPTExFQ1RJT05fTkFNRSwgaWQpXHJcbiAgICAgIGNvbnN0IGRyYWZ0U25hcCA9IGF3YWl0IGdldERvYyhkcmFmdFJlZilcclxuICAgICAgXHJcbiAgICAgIGlmIChkcmFmdFNuYXAuZXhpc3RzKCkpIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgaWQ6IGRyYWZ0U25hcC5pZCxcclxuICAgICAgICAgIC4uLmRyYWZ0U25hcC5kYXRhKClcclxuICAgICAgICB9IGFzIEZpcmViYXNlRHJhZnREYXRhXHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuIG51bGxcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0ZhaWxlZCB0byBnZXQgZHJhZnQ6JywgZXJyb3IpXHJcbiAgICAgIHJldHVybiBudWxsXHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBHZXQgYWxsIGFjdGl2ZSBkcmFmdHMgZm9yIGEgdXNlclxyXG4gICAqL1xyXG4gIHN0YXRpYyBhc3luYyBnZXRBbGxEcmFmdHModXNlcklkOiBzdHJpbmcgPSAnYW5vbnltb3VzJyk6IFByb21pc2U8RmlyZWJhc2VEcmFmdERhdGFbXT4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgLy8gU2ltcGxpZmllZCBxdWVyeSB0byBhdm9pZCBuZWVkaW5nIGEgY29tcG9zaXRlIGluZGV4XHJcbiAgICAgIGNvbnN0IHEgPSBxdWVyeShcclxuICAgICAgICBjb2xsZWN0aW9uKGRiLCB0aGlzLkNPTExFQ1RJT05fTkFNRSksXHJcbiAgICAgICAgd2hlcmUoJ3VzZXJJZCcsICc9PScsIHVzZXJJZCksXHJcbiAgICAgICAgd2hlcmUoJ2lzQWN0aXZlJywgJz09JywgdHJ1ZSlcclxuICAgICAgKVxyXG4gICAgICBcclxuICAgICAgY29uc3QgcXVlcnlTbmFwc2hvdCA9IGF3YWl0IGdldERvY3MocSlcclxuICAgICAgY29uc3QgZHJhZnRzOiBGaXJlYmFzZURyYWZ0RGF0YVtdID0gW11cclxuICAgICAgXHJcbiAgICAgIHF1ZXJ5U25hcHNob3QuZm9yRWFjaCgoZG9jKSA9PiB7XHJcbiAgICAgICAgZHJhZnRzLnB1c2goe1xyXG4gICAgICAgICAgaWQ6IGRvYy5pZCxcclxuICAgICAgICAgIC4uLmRvYy5kYXRhKClcclxuICAgICAgICB9IGFzIEZpcmViYXNlRHJhZnREYXRhKVxyXG4gICAgICB9KVxyXG4gICAgICBcclxuICAgICAgLy8gU29ydCBieSBsYXN0U2F2ZWQgaW4gbWVtb3J5IHRvIGF2b2lkIG5lZWRpbmcgYSBjb21wb3NpdGUgaW5kZXhcclxuICAgICAgcmV0dXJuIGRyYWZ0cy5zb3J0KChhLCBiKSA9PiB7XHJcbiAgICAgICAgY29uc3QgYVRpbWUgPSBhLmxhc3RTYXZlZD8udG9EYXRlPy4oKT8uZ2V0VGltZSgpIHx8IDBcclxuICAgICAgICBjb25zdCBiVGltZSA9IGIubGFzdFNhdmVkPy50b0RhdGU/LigpPy5nZXRUaW1lKCkgfHwgMFxyXG4gICAgICAgIHJldHVybiBiVGltZSAtIGFUaW1lIC8vIERlc2Mgb3JkZXJcclxuICAgICAgfSlcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0ZhaWxlZCB0byBnZXQgZHJhZnRzOicsIGVycm9yKVxyXG4gICAgICByZXR1cm4gW11cclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIERlbGV0ZSBhIGRyYWZ0IChzb2Z0IGRlbGV0ZSBieSBtYXJraW5nIGFzIGluYWN0aXZlKVxyXG4gICAqL1xyXG4gIHN0YXRpYyBhc3luYyBkZWxldGVEcmFmdChpZDogc3RyaW5nKTogUHJvbWlzZTxib29sZWFuPiB7XHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCBkcmFmdFJlZiA9IGRvYyhkYiwgdGhpcy5DT0xMRUNUSU9OX05BTUUsIGlkKVxyXG4gICAgICBcclxuICAgICAgLy8gR2V0IGRyYWZ0IGRhdGEgdG8gY2xlYW4gdXAgaW1hZ2UgaWYgbmVlZGVkXHJcbiAgICAgIGNvbnN0IGRyYWZ0U25hcCA9IGF3YWl0IGdldERvYyhkcmFmdFJlZilcclxuICAgICAgaWYgKGRyYWZ0U25hcC5leGlzdHMoKSkge1xyXG4gICAgICAgIGNvbnN0IGRyYWZ0RGF0YSA9IGRyYWZ0U25hcC5kYXRhKCkgYXMgRmlyZWJhc2VEcmFmdERhdGFcclxuICAgICAgICBcclxuICAgICAgICAvLyBEZWxldGUgaW1hZ2UgZnJvbSBzdG9yYWdlIGlmIGV4aXN0c1xyXG4gICAgICAgIGlmIChkcmFmdERhdGEuaW1hZ2VTdG9yYWdlUGF0aCkge1xyXG4gICAgICAgICAgYXdhaXQgdGhpcy5kZWxldGVJbWFnZShkcmFmdERhdGEuaW1hZ2VTdG9yYWdlUGF0aClcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgICAgXHJcbiAgICAgIC8vIFNvZnQgZGVsZXRlIGJ5IG1hcmtpbmcgYXMgaW5hY3RpdmVcclxuICAgICAgYXdhaXQgdXBkYXRlRG9jKGRyYWZ0UmVmLCB7XHJcbiAgICAgICAgaXNBY3RpdmU6IGZhbHNlLFxyXG4gICAgICAgIGxhc3RTYXZlZDogc2VydmVyVGltZXN0YW1wKClcclxuICAgICAgfSlcclxuICAgICAgXHJcbiAgICAgIHJldHVybiB0cnVlXHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdGYWlsZWQgdG8gZGVsZXRlIGRyYWZ0OicsIGVycm9yKVxyXG4gICAgICByZXR1cm4gZmFsc2VcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFNldCB1cCByZWFsLXRpbWUgbGlzdGVuZXIgZm9yIGRyYWZ0c1xyXG4gICAqL1xyXG4gIHN0YXRpYyBvbkRyYWZ0c0NoYW5nZSh1c2VySWQ6IHN0cmluZyA9ICdhbm9ueW1vdXMnLCBjYWxsYmFjazogKGRyYWZ0czogRmlyZWJhc2VEcmFmdERhdGFbXSkgPT4gdm9pZCk6ICgpID0+IHZvaWQge1xyXG4gICAgLy8gU2ltcGxpZmllZCBxdWVyeSB0byBhdm9pZCBuZWVkaW5nIGEgY29tcG9zaXRlIGluZGV4XHJcbiAgICBjb25zdCBxID0gcXVlcnkoXHJcbiAgICAgIGNvbGxlY3Rpb24oZGIsIHRoaXMuQ09MTEVDVElPTl9OQU1FKSxcclxuICAgICAgd2hlcmUoJ3VzZXJJZCcsICc9PScsIHVzZXJJZCksXHJcbiAgICAgIHdoZXJlKCdpc0FjdGl2ZScsICc9PScsIHRydWUpXHJcbiAgICApXHJcblxyXG4gICAgcmV0dXJuIG9uU25hcHNob3QocSwgKHF1ZXJ5U25hcHNob3QpID0+IHtcclxuICAgICAgY29uc3QgZHJhZnRzOiBGaXJlYmFzZURyYWZ0RGF0YVtdID0gW11cclxuICAgICAgcXVlcnlTbmFwc2hvdC5mb3JFYWNoKChkb2MpID0+IHtcclxuICAgICAgICBkcmFmdHMucHVzaCh7XHJcbiAgICAgICAgICBpZDogZG9jLmlkLFxyXG4gICAgICAgICAgLi4uZG9jLmRhdGEoKVxyXG4gICAgICAgIH0gYXMgRmlyZWJhc2VEcmFmdERhdGEpXHJcbiAgICAgIH0pXHJcbiAgICAgIFxyXG4gICAgICAvLyBTb3J0IGJ5IGxhc3RTYXZlZCBpbiBtZW1vcnkgdG8gYXZvaWQgbmVlZGluZyBhIGNvbXBvc2l0ZSBpbmRleFxyXG4gICAgICBjb25zdCBzb3J0ZWREcmFmdHMgPSBkcmFmdHMuc29ydCgoYSwgYikgPT4ge1xyXG4gICAgICAgIGNvbnN0IGFUaW1lID0gYS5sYXN0U2F2ZWQ/LnRvRGF0ZT8uKCk/LmdldFRpbWUoKSB8fCAwXHJcbiAgICAgICAgY29uc3QgYlRpbWUgPSBiLmxhc3RTYXZlZD8udG9EYXRlPy4oKT8uZ2V0VGltZSgpIHx8IDBcclxuICAgICAgICByZXR1cm4gYlRpbWUgLSBhVGltZSAvLyBEZXNjIG9yZGVyXHJcbiAgICAgIH0pXHJcbiAgICAgIFxyXG4gICAgICBjYWxsYmFjayhzb3J0ZWREcmFmdHMpXHJcbiAgICB9LCAoZXJyb3IpID0+IHtcclxuICAgICAgY29uc29sZS5lcnJvcignUmVhbC10aW1lIGRyYWZ0cyBsaXN0ZW5lciBlcnJvcjonLCBlcnJvcilcclxuICAgIH0pXHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBTZXQgdXAgcmVhbC10aW1lIGxpc3RlbmVyIGZvciBhIHNwZWNpZmljIGRyYWZ0XHJcbiAgICovXHJcbiAgc3RhdGljIG9uRHJhZnRDaGFuZ2UoZHJhZnRJZDogc3RyaW5nLCBjYWxsYmFjazogKGRyYWZ0OiBGaXJlYmFzZURyYWZ0RGF0YSB8IG51bGwpID0+IHZvaWQpOiAoKSA9PiB2b2lkIHtcclxuICAgIGNvbnN0IGRyYWZ0UmVmID0gZG9jKGRiLCB0aGlzLkNPTExFQ1RJT05fTkFNRSwgZHJhZnRJZClcclxuICAgIFxyXG4gICAgcmV0dXJuIG9uU25hcHNob3QoZHJhZnRSZWYsIChkb2MpID0+IHtcclxuICAgICAgaWYgKGRvYy5leGlzdHMoKSkge1xyXG4gICAgICAgIGNhbGxiYWNrKHtcclxuICAgICAgICAgIGlkOiBkb2MuaWQsXHJcbiAgICAgICAgICAuLi5kb2MuZGF0YSgpXHJcbiAgICAgICAgfSBhcyBGaXJlYmFzZURyYWZ0RGF0YSlcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBjYWxsYmFjayhudWxsKVxyXG4gICAgICB9XHJcbiAgICB9LCAoZXJyb3IpID0+IHtcclxuICAgICAgY29uc29sZS5lcnJvcignUmVhbC10aW1lIGRyYWZ0IGxpc3RlbmVyIGVycm9yOicsIGVycm9yKVxyXG4gICAgfSlcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFVwbG9hZCBpbWFnZSB0byBGaXJlYmFzZSBTdG9yYWdlXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBzdGF0aWMgYXN5bmMgdXBsb2FkSW1hZ2UoZmlsZTogRmlsZSwgZHJhZnRJZDogc3RyaW5nKTogUHJvbWlzZTx7IGRvd25sb2FkVXJsOiBzdHJpbmcsIHN0b3JhZ2VQYXRoOiBzdHJpbmcgfT4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3Qgc3RvcmFnZVBhdGggPSBgJHt0aGlzLlNUT1JBR0VfUEFUSH0vJHtkcmFmdElkfS8ke2ZpbGUubmFtZX1gXHJcbiAgICAgIGNvbnN0IGltYWdlUmVmID0gcmVmKHN0b3JhZ2UsIHN0b3JhZ2VQYXRoKVxyXG4gICAgICBcclxuICAgICAgYXdhaXQgdXBsb2FkQnl0ZXMoaW1hZ2VSZWYsIGZpbGUpXHJcbiAgICAgIGNvbnN0IGRvd25sb2FkVXJsID0gYXdhaXQgZ2V0RG93bmxvYWRVUkwoaW1hZ2VSZWYpXHJcbiAgICAgIFxyXG4gICAgICByZXR1cm4geyBkb3dubG9hZFVybCwgc3RvcmFnZVBhdGggfVxyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRmFpbGVkIHRvIHVwbG9hZCBpbWFnZTonLCBlcnJvcilcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKCdGYWlsZWQgdG8gdXBsb2FkIGltYWdlJylcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIERlbGV0ZSBpbWFnZSBmcm9tIEZpcmViYXNlIFN0b3JhZ2VcclxuICAgKi9cclxuICBwcml2YXRlIHN0YXRpYyBhc3luYyBkZWxldGVJbWFnZShzdG9yYWdlUGF0aDogc3RyaW5nKTogUHJvbWlzZTx2b2lkPiB7XHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCBpbWFnZVJlZiA9IHJlZihzdG9yYWdlLCBzdG9yYWdlUGF0aClcclxuICAgICAgYXdhaXQgZGVsZXRlT2JqZWN0KGltYWdlUmVmKVxyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRmFpbGVkIHRvIGRlbGV0ZSBpbWFnZTonLCBlcnJvcilcclxuICAgICAgLy8gRG9uJ3QgdGhyb3cgZXJyb3IgYXMgdGhpcyBpcyBjbGVhbnVwXHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBHZW5lcmF0ZSB1bmlxdWUgZHJhZnQgSURcclxuICAgKi9cclxuICBwcml2YXRlIHN0YXRpYyBnZW5lcmF0ZURyYWZ0SWQoKTogc3RyaW5nIHtcclxuICAgIHJldHVybiBgZHJhZnRfJHtEYXRlLm5vdygpfV8ke01hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnN1YnN0cigyLCA5KX1gXHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBNaWdyYXRlIGV4aXN0aW5nIGxvY2FsU3RvcmFnZSBkcmFmdHMgdG8gRmlyZWJhc2VcclxuICAgKi9cclxuICBzdGF0aWMgYXN5bmMgbWlncmF0ZUxvY2FsRHJhZnRzKCk6IFByb21pc2U8dm9pZD4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgLy8gSW1wb3J0IHRoZSBleGlzdGluZyBkcmFmdCBzdG9yYWdlIHRvIGFjY2VzcyBsb2NhbCBkcmFmdHNcclxuICAgICAgY29uc3QgeyBEcmFmdFN0b3JhZ2VWMiB9ID0gYXdhaXQgaW1wb3J0KCcuLi91dGlscy9kcmFmdFN0b3JhZ2UudjInKVxyXG4gICAgICBjb25zdCBsb2NhbERyYWZ0cyA9IERyYWZ0U3RvcmFnZVYyLmdldEFsbERyYWZ0cygpXHJcbiAgICAgIFxyXG4gICAgICBjb25zb2xlLmxvZyhgRm91bmQgJHtsb2NhbERyYWZ0cy5sZW5ndGh9IGxvY2FsIGRyYWZ0cyB0byBtaWdyYXRlYClcclxuICAgICAgXHJcbiAgICAgIGZvciAoY29uc3QgbG9jYWxEcmFmdCBvZiBsb2NhbERyYWZ0cykge1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICBjb25zdCBmaXJlYmFzZURyYWZ0OiBQYXJ0aWFsPEZpcmViYXNlRHJhZnREYXRhPiA9IHtcclxuICAgICAgICAgICAgZHJhZnRJZDogbG9jYWxEcmFmdC5kcmFmdElkLFxyXG4gICAgICAgICAgICBjcmVhdGl2ZUZpbGVuYW1lOiBsb2NhbERyYWZ0LmNyZWF0aXZlRmlsZW5hbWUsXHJcbiAgICAgICAgICAgIGZvcm1EYXRhOiBsb2NhbERyYWZ0LmZvcm1EYXRhLFxyXG4gICAgICAgICAgICBhdXRvU2F2ZWQ6IGxvY2FsRHJhZnQuYXV0b1NhdmVkLFxyXG4gICAgICAgICAgICB2ZXJzaW9uOiAxLFxyXG4gICAgICAgICAgICBpc0FjdGl2ZTogdHJ1ZVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgXHJcbiAgICAgICAgICBhd2FpdCB0aGlzLnNhdmVEcmFmdChmaXJlYmFzZURyYWZ0KVxyXG4gICAgICAgICAgY29uc29sZS5sb2coYE1pZ3JhdGVkIGRyYWZ0OiAke2xvY2FsRHJhZnQuY3JlYXRpdmVGaWxlbmFtZX1gKVxyXG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgICBjb25zb2xlLmVycm9yKGBGYWlsZWQgdG8gbWlncmF0ZSBkcmFmdCAke2xvY2FsRHJhZnQuZHJhZnRJZH06YCwgZXJyb3IpXHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgICBjb25zb2xlLmxvZygnRHJhZnQgbWlncmF0aW9uIGNvbXBsZXRlZCcpXHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdGYWlsZWQgdG8gbWlncmF0ZSBsb2NhbCBkcmFmdHM6JywgZXJyb3IpXHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBHZXQgcmVhbC10aW1lIHRyYWNraW5nIHN0YXRpc3RpY3NcclxuICAgKi9cclxuICBzdGF0aWMgYXN5bmMgZ2V0VHJhY2tpbmdTdGF0cyh1c2VySWQ6IHN0cmluZyA9ICdhbm9ueW1vdXMnKTogUHJvbWlzZTx7XHJcbiAgICB0b3RhbERyYWZ0czogbnVtYmVyXHJcbiAgICBhdXRvU2F2ZWRDb3VudDogbnVtYmVyXHJcbiAgICBtYW51YWxTYXZlZENvdW50OiBudW1iZXJcclxuICAgIGFpUG9wdWxhdGVkQ291bnQ6IG51bWJlclxyXG4gIH0+IHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IGRyYWZ0cyA9IGF3YWl0IHRoaXMuZ2V0QWxsRHJhZnRzKHVzZXJJZClcclxuICAgICAgXHJcbiAgICAgIGNvbnN0IHN0YXRzID0ge1xyXG4gICAgICAgIHRvdGFsRHJhZnRzOiBkcmFmdHMubGVuZ3RoLFxyXG4gICAgICAgIGF1dG9TYXZlZENvdW50OiBkcmFmdHMuZmlsdGVyKGQgPT4gZC5hdXRvU2F2ZWQpLmxlbmd0aCxcclxuICAgICAgICBtYW51YWxTYXZlZENvdW50OiBkcmFmdHMuZmlsdGVyKGQgPT4gIWQuYXV0b1NhdmVkKS5sZW5ndGgsXHJcbiAgICAgICAgYWlQb3B1bGF0ZWRDb3VudDogZHJhZnRzLmZpbHRlcihkID0+IGQuYWlQb3B1bGF0ZWRGaWVsZHMgJiYgZC5haVBvcHVsYXRlZEZpZWxkcy5sZW5ndGggPiAwKS5sZW5ndGhcclxuICAgICAgfVxyXG4gICAgICBcclxuICAgICAgcmV0dXJuIHN0YXRzXHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdGYWlsZWQgdG8gZ2V0IHRyYWNraW5nIHN0YXRzOicsIGVycm9yKVxyXG4gICAgICByZXR1cm4ge1xyXG4gICAgICAgIHRvdGFsRHJhZnRzOiAwLFxyXG4gICAgICAgIGF1dG9TYXZlZENvdW50OiAwLFxyXG4gICAgICAgIG1hbnVhbFNhdmVkQ291bnQ6IDAsXHJcbiAgICAgICAgYWlQb3B1bGF0ZWRDb3VudDogMFxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG59Il0sIm5hbWVzIjpbImNvbGxlY3Rpb24iLCJkb2MiLCJhZGREb2MiLCJ1cGRhdGVEb2MiLCJnZXREb2NzIiwiZ2V0RG9jIiwib25TbmFwc2hvdCIsInF1ZXJ5Iiwid2hlcmUiLCJzZXJ2ZXJUaW1lc3RhbXAiLCJyZWYiLCJ1cGxvYWRCeXRlcyIsImdldERvd25sb2FkVVJMIiwiZGVsZXRlT2JqZWN0IiwiZGIiLCJzdG9yYWdlIiwiRmlyZWJhc2VEcmFmdFNlcnZpY2UiLCJ0ZXN0Q29ubmVjdGlvbiIsImNvbnNvbGUiLCJsb2ciLCJxIiwiQ09MTEVDVElPTl9OQU1FIiwiZXJyb3IiLCJzYXZlRHJhZnQiLCJkYXRhIiwiaW1hZ2VGaWxlIiwiY2xlYW5Gb3JtRGF0YSIsImZvcm1EYXRhIiwidXBsb2FkZWRJbWFnZSIsImZpbGUiLCJuYW1lIiwic2l6ZSIsInR5cGUiLCJsYXN0TW9kaWZpZWQiLCJpc0ZpbGVPYmplY3QiLCJkcmFmdERhdGEiLCJkcmFmdElkIiwiZ2VuZXJhdGVEcmFmdElkIiwiY3JlYXRpdmVGaWxlbmFtZSIsImxhc3RTYXZlZCIsImF1dG9TYXZlZCIsImFpUG9wdWxhdGVkRmllbGRzIiwidmVyc2lvbiIsImlzQWN0aXZlIiwidXNlcklkIiwiaW1hZ2VEYXRhIiwidXBsb2FkSW1hZ2UiLCJpbWFnZVVybCIsImRvd25sb2FkVXJsIiwiaW1hZ2VTdG9yYWdlUGF0aCIsInN0b3JhZ2VQYXRoIiwiaW1hZ2VFcnJvciIsIndhcm4iLCJpZCIsImRyYWZ0UmVmIiwiY3JlYXRlZEF0IiwiZG9jUmVmIiwiRXJyb3IiLCJnZXREcmFmdCIsImRyYWZ0U25hcCIsImV4aXN0cyIsImdldEFsbERyYWZ0cyIsInF1ZXJ5U25hcHNob3QiLCJkcmFmdHMiLCJmb3JFYWNoIiwicHVzaCIsInNvcnQiLCJhIiwiYiIsImFUaW1lIiwidG9EYXRlIiwiZ2V0VGltZSIsImJUaW1lIiwiZGVsZXRlRHJhZnQiLCJkZWxldGVJbWFnZSIsIm9uRHJhZnRzQ2hhbmdlIiwiY2FsbGJhY2siLCJzb3J0ZWREcmFmdHMiLCJvbkRyYWZ0Q2hhbmdlIiwiU1RPUkFHRV9QQVRIIiwiaW1hZ2VSZWYiLCJNYXRoIiwiRGF0ZSIsIm5vdyIsInJhbmRvbSIsInRvU3RyaW5nIiwic3Vic3RyIiwibWlncmF0ZUxvY2FsRHJhZnRzIiwiRHJhZnRTdG9yYWdlVjIiLCJsb2NhbERyYWZ0cyIsImxlbmd0aCIsImxvY2FsRHJhZnQiLCJmaXJlYmFzZURyYWZ0IiwiZ2V0VHJhY2tpbmdTdGF0cyIsInN0YXRzIiwidG90YWxEcmFmdHMiLCJhdXRvU2F2ZWRDb3VudCIsImZpbHRlciIsImQiLCJtYW51YWxTYXZlZENvdW50IiwiYWlQb3B1bGF0ZWRDb3VudCJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(app-pages-browser)/./lib/firebase-draft-service.ts\n"));

/***/ })

});